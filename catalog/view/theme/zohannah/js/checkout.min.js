/*! nixon 18-03-2015 */
function _PlaceProductItems(){var w=jQuery(window).outerWidth();jQuery(".nix-checkout-container .checkout-list-responsive .product-row").each(750>w?function(){if(""==jQuery(this).find(".mobile-container-2").html().trim()){var html=jQuery(this).find(".normal-container").html();jQuery(this).find(".mobile-container-2").html(html),jQuery(this).find(".normal-container").html(""),jQuery(this).find(".mobile-container").removeClass("col-xs-6").addClass("col-xs-12"),jQuery(this).find(".product-quantity").parent().removeClass("col-xs-6").addClass("col-xs-9")}}:function(){if(""==jQuery(this).find(".normal-container").html().trim()){var html=jQuery(this).find(".mobile-container-2").html();jQuery(this).find(".normal-container").html(html),jQuery(this).find(".mobile-container-2").html(""),jQuery(this).find(".mobile-container").removeClass("col-xs-12").addClass("col-xs-6"),jQuery(this).find(".product-quantity").parent().removeClass("col-xs-9").addClass("col-xs-6")}})}function _AutocalcWidths(){jQuery(".nix-checkout-container .autocalc-width").each(function(){var s=1*jQuery(this).attr("data-autocalc-s"),t=1*jQuery(this).attr("data-autocalc-t");0!=t&&jQuery(this).css("width",t+"%");var w=jQuery(this).width()-s;jQuery(this).width(w),jQuery(this).hasClass("nix-select")&&jQuery(this).css("background-position-x",jQuery(this).outerWidth()-25+"px")})}function _FirstProductRow(){var w=jQuery(window).width();jQuery(".nix-checkout-container .checkout-list-responsive .product-row").first().children().css(w>950?{height:"100%","margin-top":"-3px"}:{height:"auto","margin-top":"0px"})}function _NixonSelects(){var _switch=!0,id=0;jQuery(".nix-checkout-container select").each(function(){id++;var html='<div class="nix-select '+jQuery(this).attr("class")+" ";jQuery(this).hasClass("half")&&(html+=_switch?" to-left ":" to-right ",_switch=!_switch),html+=' " ',jQuery(this).hasClass("autocalc-width")&&(html+=' data-autocalc-t="'+jQuery(this).attr("data-autocalc-t")+'" data-autocalc-s="'+jQuery(this).attr("data-autocalc-s")+'" '),html+=' for="nix-old-select-'+id+'" ',html+=">",html+='<span class="placeholder">'+jQuery(this).children().first().html()+"</span>",html+='<div class="options">',html+="<ul>",jQuery(this).children().each(function(){html+='<li class="list-item" value="'+jQuery(this).attr("value")+'">'+jQuery(this).html()+"</li>"}),html+="</ul></div>",html+="</div>",jQuery(this).before(html),jQuery(this).hide().addClass("nix-old-select-"+id),jQuery(this).hasClass("autocalc-width")&&_AutocalcWidths()})}function _FirstRowBorder(){var w=jQuery(window).outerWidth();jQuery(".nix-checkout-container .checkout-list-responsive").each(768>w?function(){jQuery(this).find(".product-row").first().addClass("no-border")}:function(){jQuery(this).find(".product-row").first().removeClass("no-border")})}function _HideMenusInConfirmationMobile(){320==jQuery(window).outerWidth()?jQuery(".nix-checkout-complete-top-container").length&&(jQuery("body>.navbar").attr("style","display: none !important"),jQuery(".nix-main-menu-container").attr("style","display: none !important")):jQuery(".nix-checkout-complete-top-container").length&&(jQuery("body>.navbar").removeAttr("style"),jQuery(".nix-main-menu-container").removeAttr("style"))}!function($){$.fn.forceNumeric=function(){this.keydown(function(e){var key=e.which||e.keyCode;return e.ctrlKey||key>=48&&57>=key||key>=96&&105>=key||8==key||9==key||13==key||35==key||36==key||37==key||39==key||46==key||45==key?!0:!1})}}(jQuery);var CLIENT=window.CLIENT||{};CLIENT.Checkout={init:function(){$.Log.debug("CLIENT.Checkout.init"),"undefined"!=typeof CLIENT.GoogleEC&&(CLIENT.GoogleEC.getGaListLabel=CLIENT.Checkout.getGaListLabel,CLIENT.GoogleEC.getGaProductList=CLIENT.Checkout.getGaProductList),CLIENT.Checkout.bindCheckoutNavigation(),CLIENT.Checkout.bindSidebarAjaxLinks(),enquire.register("screen and (min-width: 768px)",{deferSetup:!1,match:function(){CLIENT.Checkout.bindStickySidebarCheck(),CLIENT.Checkout.bindStickySidebarWatch()}}),enquire.register("screen and (max-width: 767px)",{match:function(){CLIENT.Checkout.unbindStickySidebar(),CLIENT.Checkout.unbindStickySidebarWatch()}})},bindCheckoutNavigation:function(){$.Log.debug("CLIENT.Checkout.bindCheckoutNavigation");var cartNav=$(".checkout-navigation");cartNav.length&&cartNav.find(".step-item.complete[data-href]").on("click touchstart",function(){document.location.href=$(this).attr("data-href")})},bindStickySidebarWatch:function(){$(window).on("resize.sticky-sidebar",function(){CLIENT.Checkout.bindStickySidebarCheck()})},unbindStickySidebarWatch:function(){$(window).off("resize.sticky-sidebar")},bindStickySidebarCheck:function(){$(".nix-side-container").height()<$(window).height()?CLIENT.Checkout.bindStickySidebar():CLIENT.Checkout.unbindStickySidebar()},bindStickySidebar:function(){$(".nix-side-container").addClass("fixed-sidebar")},unbindStickySidebar:function(){$(".nix-side-container").removeClass("fixed-sidebar")},bindSidebarAjaxLinks:function(){$.Log.debug("CLIENT.Checkout.bindSidebarAjaxLinks");var container=$(".nix-checkout-container");container.on("click.ajaxload",".ajaxlink[data-refid]",function(e){e.preventDefault()}).on("click.ajaxload",".ajaxlink[data-refid]",function(e){e.stopImmediatePropagation();var articleRefid=$(this).attr("data-refid");CLIENT.Modal.ajaxLoadArticle(articleRefid,"")})},richRelevanceCallback:function(){var ar=RR.data.JSON.placements;if("undefined"!=typeof ar)for(var x=0;x<ar.length;x++){var placement=ar[x],type=placement.placement_name;if(type.indexOf("rr1")>-1)var richRecs=placement;else if(type.indexOf("rvi")>-1)var richViews=placement}CLIENT.RichRelevance.bindRichRelevanceLayers(richRecs,richViews),richRecs?CLIENT.RichRelevance.loadRecsForSkus(richRecs,$("#rr-recommend-container")):$.Log.debug("No products returned for rr1"),richViews?CLIENT.RichRelevance.loadRecsForSkus(richViews,$("#rr-recent-container")):$.Log.debug("No products returned for rv1"),CLIENT.iosSlider.bindCarouselProductHotSpot({gaProductList:CLIENT.Checkout.getGaProductList,gaListLabel:CLIENT.Checkout.getGaListLabel}),CLIENT.iosSlider.bindFavoriteLinkClick()},getGaProductList:function(product){var list="";try{return product.parents("#rr-recommend-container").length?list="Rich Recommendations":product.parents("#rr-recent-container").length?list="Recently Viewed":product.parents("#featured-products").length&&(list="Featured Products"),list}catch(e){return list}},getGaListLabel:function(){return"Checkout Complete"},Cart:{maxQuantities:{},init:function(){$.Log.debug("CLIENT.Checkout.Cart.init");var cartObj=CLIENT.Checkout.Cart;cartObj.bindZipCodeEntry(),cartObj.bindShippingMethodHooks(),cartObj.bindContinueCheckoutForm(),cartObj.bindItemQuantityHooks(),cartObj.bindItemRemoveHooks(),cartObj.bindDecrementHooks(),cartObj.bindItemIncrementHooks(),cartObj.checkAreFormsAvailable()},setMaxVars:function(o){CLIENT.Checkout.Cart.maxQuantities=o},validateCartSubmit:function(){var items=$("input[id^='qtyhidden-']"),canContinue=!0;return items.each(function(){var qty=Number($(this).val()),id=$(this).attr("id"),args=id.split("-");if(isNaN(qty)||0>=qty){canContinue=!1;var detailWrapper=$("#itemDetail-"+args[1]),err=(detailWrapper.find(".cart-item-content"),detailWrapper.find(".cart-item-error").filter(function(){return $.trim($(this).text())==CLIENT.Settings.alerts.checkout.itemQuantityError}));0==err.length&&(detailWrapper.append("<div class='col-xs-12 cart-item-error'>"+CLIENT.Settings.alerts.checkout.itemQuantityError+"</div>"),CLIENT.Checkout.Cart.checkAreFormsAvailable())}}),CLIENT.util.hideButton("cartbutton"),canContinue},checkAreFormsAvailable:function(){$(".cart-item-error").length>0?($("#cartzip").attr("disabled","disabled"),$("#cartshipmethod").attr("disabled","disabled")):($("#cartzip").removeAttr("disabled"),$("#cartshipmethod").removeAttr("disabled"))},bindZipCodeEntry:function(){$.Log.debug("CLIENT.Checkout.Cart.bindZipCodeEntry()"),$("#cartzip").keyup($.debounce(500,CLIENT.Checkout.Cart.captureZipCodeKeyPress)).keydown(CLIENT.Checkout.Cart.limitZipCodeKeyPress)},bindShippingMethodHooks:function(){$.Log.debug("CLIENT.Checkout.Cart.bindShippingMethodClick"),$(".nix-checkout-container").on("change",":input[name='zo_shipping_method_id']",$.debounce(300,CLIENT.Checkout.Cart.trackShippingChange)),$("#shipRateWrapper").is(":hidden")&&$(":input[name='zo_shipping_method_id']").each(function(){$(this).attr("disabled","disabled")})},bindContinueCheckoutForm:function(){$.Log.debug("CLIENT.Checkout.Cart.bindContinueCheckoutForm"),$("#continueCheckoutForm").submit(CLIENT.Checkout.Cart.validateCartSubmit)},bindItemQuantityHooks:function(){$.Log.debug("CLIENT.Checkout.Cart.bindItemQuantityHooks");var qtyEls=$(".nix-checkout-container").find("input[id^='qty-']");qtyEls.forceNumeric(),qtyEls.keyup(CLIENT.Checkout.Cart.updateHiddenQuantity).keyup(CLIENT.Checkout.Cart.submitOnQuantityChange)},bindDecrementHooks:function(){$.Log.debug("CLIENT.Checkout.Cart.bindDecrementHooks");var itemContainer=$(".nix-checkout-container"),links=itemContainer.find("a.decrementing");links.each(function(){var q=$(this).siblings(".product-quantity").val();1==q?$(this).html("&times;").attr("mode",0):$(this).html("-").attr("mode",1)}),itemContainer.on("click.changeval","a.decrementing",function(e){e.preventDefault();var button=$(this),m=button.attr("mode"),q=button.siblings(".product-quantity").val(),id=button.attr("data-itemid");if(1==m?(button.siblings(".product-quantity").val(--q),1==q&&button.attr("mode",0).html("&times;")):(q>0&&button.siblings(".product-quantity").val(0),$("#zoi_delete-"+id).val("TRUE")),CLIENT.Settings.gaEnhancedEC&&ga.loaded)try{var gaProduct=window.cartItems[id],label="Decrement Qty",input=button.siblings(".product-quantity"),initial=Number(input.attr("data-initialquant")),current=Number(input.val());if(0>=current)var gaQuant=initial;else if(initial>current)var gaQuant=initial-current;ga("ec:setAction","remove"),gaProduct.quantity=gaQuant,ga("ec:addProduct",gaProduct),ga("send","event","Checkout",label,{hitCallback:function(){CLIENT.Checkout.Cart.submitItemUpdateForm()}})}catch(e){CLIENT.Checkout.Cart.submitItemUpdateForm()}else CLIENT.Checkout.Cart.submitItemUpdateForm()})},submitItemUpdateForm:function(){$.Log.debug("Submitting the item Update form"),$("#formqtyupdate").submit()},bindItemRemoveHooks:function(){$.Log.debug("CLIENT.Checkout.Cart.bindItemRemoveHooks");var qtyRemove=$(".nix-checkout-container").find("a[id^=itemRemove-]");qtyRemove.on("click",$.debounce(250,function(){CLIENT.Checkout.Cart.removeItemFromCart($(this))}))},removeItemFromCart:function(button){var id=button.attr("data-itemid");if($("a[data-itemid='"+id+"']").attr("disabled","disabled"),$("#zoi_delete-"+id).val("TRUE"),CLIENT.Settings.gaEnhancedEC&&ga.loaded)try{var gaProduct=window.cartItems[id];ga("ec:addProduct",gaProduct),ga("ec:setAction","remove"),ga("send","event","Checkout","Remove Item",{hitCallback:function(){CLIENT.Checkout.Cart.submitItemUpdateForm()}})}catch(e){CLIENT.Checkout.Cart.submitItemUpdateForm()}else CLIENT.Checkout.Cart.submitItemUpdateForm()},bindItemIncrementHooks:function(){$.Log.debug("CLIENT.Checkout.Cart.bindItemIncrementHooks");var itemContainer=$(".nix-checkout-container");itemContainer.on("click.changeval","a.incrementing",function(){var button=$(this),id=button.attr("data-itemid");$.Log.debug("incrementing: "+id),button.siblings(".decrementing").html("-").attr("mode",1);var input=$("#qty-"+id),count=Number(input.val());if(input.val(count+1),CLIENT.Settings.gaEnhancedEC&&ga.loaded)try{var gaProduct=window.cartItems[id],label="Increment Qty";ga("ec:setAction","add"),gaProduct.quantity=1,ga("ec:addProduct",gaProduct),ga("send","event","Checkout",label,{hitCallback:function(){CLIENT.Checkout.Cart.submitItemUpdateForm()}})}catch(e){CLIENT.Checkout.Cart.submitItemUpdateForm()}else CLIENT.Checkout.Cart.submitItemUpdateForm()})},limitZipCodeKeyPress:function(e){if("en_US"==CLIENT.Settings.locale.code){var key=e.which||e.keyCode,curval=$(this).val(),selectedText=CLIENT.Base.getSelectedText();return 0!=selectedText.length&&-1!=curval.indexOf(selectedText)&&(curval=curval.replace(selectedText,""),$(this).val(curval)),curval.length>=5&&!e.ctrlKey&&8!=key&&9!=key&&13!=key&&46!=key?!1:e.ctrlKey||key>=48&&57>=key||key>=96&&105>=key||8==key||9==key||13==key||35==key||36==key||37==key||39==key||46==key||45==key?!0:!1}},captureZipCodeKeyPress:function(e){if($.Log.debug("in captureZipCodeKeyPress"),"en_US"==CLIENT.Settings.locale.code){var key=e.which||e.keyCode;if("undefined"==typeof key||key>=48&&57>=key||key>=96&&105>=key){var val=CLIENT.Base.digitOnly($(this).val());$(this).val(val),5==$(this).val().length&&CLIENT.Checkout.Cart.updateForZipCode(val)}}else"en_CA"==CLIENT.Settings.locale.code&&$("#cartzip").val().length>=6&&CLIENT.Checkout.Cart.updateForZipCode($("#cartzip").val())},updateForZipCode:function(zip){CLIENT.Settings.gaEnhancedEC&&ga.loaded?(ga("ec:setAction","checkout_option",{step:1,option:"PostalCode Entered"}),ga("send","event","Checkout","Option",{hitCallback:function(){CLIENT.Checkout.Cart.submitOnZipCodeChange(zip)}})):CLIENT.Checkout.Cart.submitOnZipCodeChange(zip)},editSalesTaxForRepairOrder:function(){$.Log.debug("CLIENT.Checkout.Cart.editSalesTaxForRepairOrder");var taxWrapper=$("#taxWrapper"),taxShipEditableRow=($("#shipRateWrapper"),$("#formGetShippingOptions").parents(".zip-code-form"));taxWrapper.addClass("hide"),taxShipEditableRow.removeClass("hide"),$("#cartzip").focus()},submitOnZipCodeChange:function(val){var form=$("#continueCheckoutForm");form.attr("action",CLIENT.Settings.getServlet());var option=form.find("input[name='OPTION']"),postalcode=form.find("input[name='postalCode']"),optionHandler="EDITCARTZIPCODE",isRepairOrder=$('form[name="formqtyupdate"]').is(".repair");isRepairOrder&&(optionHandler="EDITREPAIRCARTZIPCODE"),0==option.length?form.append("<input type='hidden' name='OPTION' value='"+optionHandler+"'/>"):option.val(optionHandler),0==postalcode.length?form.prepend("<input type='hidden' name='postalCode' value='"+val+"'/>"):postalcode.val(val);var zipUrl=CLIENT.Settings.getHost()+"/cart/shiprates/",wrapper=$("#cartUpdateFormWrapper");CLIENT.util.hideButton("cartbutton"),$.ajax({url:zipUrl,type:"POST",data:form.serialize(),success:function(data){var response=$(data);if("continueCheckoutForm"==response.attr("id")){if(wrapper.html(response),$("#tax-estimate-wrapper").html($("#cartTaxAmount").attr("data-taxamount-ui")),isRepairOrder&&$("#cartTotalAmount",response).attr("data-totalnoship")>0)$("#formGetShippingOptions").parents(".zip-code-form").addClass("hide");else if(($("body").hasClass("en_CA")||$("body").hasClass("en_US"))&&$("#cartTotalAmount",response).attr("data-totalnoship")>0){var hideTaxForm=$.trim($("#cartTaxAmount").attr("data-editable-state"));"true"==hideTaxForm&&$("#formGetShippingOptions").parents(".zip-code-form").addClass("hide")}}else $.Log.debug("$.ajax.error() : "+response,null,"ERROR"),CLIENT.util.enableButton("cartbutton")},error:function(response){$.Log.debug("$.ajax.error() : "+response.statusText,null,"ERROR"),CLIENT.util.enableButton("cartbutton")}})},submitOnQuantityChange:function(e){$.Log.debug("CLIENT.Checkout.Cart.submitOnQuantityChange");var key=e.which||e.keyCode;if(key>=48&&57>=key||key>=96&&105>=key){var input=$(this),maxWatches=CLIENT.Checkout.Cart.maxQuantities.watches,maxOther=CLIENT.Checkout.Cart.maxQuantities.other,itemType=input.attr("data-category"),itemMax=3;try{0!=itemType.length&&"undefined"!=typeof itemType&&(itemMax="watches"==itemType?maxWatches:maxOther)}catch(Exception){$.Log.error(Exception)}var qty=Number($.trim(input.val())),id=input.attr("data-itemid"),detailWrapper=$("#itemDetail-"+id),err=(detailWrapper.find(".cart-item-content"),detailWrapper.find(".cart-item-error"));if(0>=qty)0==err.length?(detailWrapper.append("<div class='col-xs-12 cart-item-error'>"+CLIENT.Settings.alerts.checkout.itemQuantityError+"</div>"),CLIENT.Checkout.Cart.checkAreFormsAvailable()):err.html(CLIENT.Settings.alerts.checkout.itemQuantityError),input.addClass("error");else if(qty>itemMax)0==err.length?(detailWrapper.append("<div class='col-xs-12 cart-item-error'>"+CLIENT.Settings.alerts.checkout.itemMaxQuantityError+" "+itemMax+"</div>"),CLIENT.Checkout.Cart.checkAreFormsAvailable()):err.html(CLIENT.Settings.alerts.checkout.itemMaxQuantityError+" "+itemMax),input.addClass("error");else if(qty>0&&itemMax>=qty)if(CLIENT.Settings.gaEnhancedEC&&ga.loaded)try{var dataId=input.attr("data-itemid"),gaProduct=window.cartItems[dataId],initialQty=Number(input.attr("data-initialquant"));if(initialQty==qty);else{var updateQty=0;if(initialQty>qty){updateQty=initialQty-qty,ga("ec:setAction","remove");var label="Decrement Qty"}else if(qty>initialQty){updateQty=qty-initialQty,ga("ec:setAction","add");var label="Increment Qty"}gaProduct.quantity=updateQty,ga("ec:addProduct",gaProduct),ga("send","event","Checkout",label,{hitCallback:function(){input.val(qty),input.parents("form[name='formqtyupdate']").submit(),input.removeClass("error")}})}}catch(e){input.val(qty),input.parents("form[name='formqtyupdate']").submit(),input.removeClass("error")}else input.val(qty),input.parents("form[name='formqtyupdate']").submit(),input.removeClass("error")}},updateHiddenQuantity:function(){var id=$(this).attr("data-itemid");$("#qtyhidden-"+id).val($(this).val())},trackShippingChange:function(){if(CLIENT.util.hideButton("cartbutton"),CLIENT.Settings.gaEnhancedEC&&ga.loaded){var shipMethod=$.trim($("#cartshipmethod option:selected").attr("data-shipmethod"));ga("ec:setAction","checkout_option",{step:1,option:"Ship Method: "+shipMethod}),ga("send","event","Checkout","Option",{hitCallback:function(){CLIENT.Checkout.Cart.selectShippingRate.call($(this))}})}else CLIENT.Checkout.Cart.selectShippingRate.call($(this))},selectShippingRate:function(){$.Log.debug("CLIENT.Checkout.Cart.selectShippingRate");var form=$("#continueCheckoutForm");form.find("input[name='OPTION']").val("EDITCARTSHIPPINGMETHOD");var zipUrl=CLIENT.Settings.getHost()+"/cart/shiprates/";$.ajax({url:zipUrl,type:"POST",data:form.serialize(),success:function(data){var response=$(data);"continueCheckoutForm"==response.attr("id")?($("#cartUpdateFormWrapper").html(response),$("#tax-amount-wrapper").html($("#shipRateWrapper").attr("data-shippingamount-ui"))):($.Log.debug("$.ajax.error() : "+response,null,"ERROR"),CLIENT.util.enableButton("cartbutton"))},error:function(response){$.Log.debug("$.ajax.error() : "+response.statusText,null,"ERROR"),CLIENT.util.enableButton("cartbutton")}})}},AddressPayment:{init:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.init");var AP=CLIENT.Checkout.AddressPayment;AP.initRecoverPasswordLink(),AP.bindContinueShopping(),AP.bindAboutYouElements(),AP.bindGiftMessageCount(),AP.bindGuestFormElements(),AP.bindLoginForm(),AP.bindPrimaryFormSubmit(),AP.bindSeeWhyDataChanges(),AP.liveCopyBillingToShipping(),AP.bindForgotPasswdSubmit(),AP.bindForgotPasswdLink(),AP.bindTogglePasswordInputs(),AP.bindToggleBillAsShip(),AP.bindToggleGiftReceipt(),AP.bindToggleGiftCardForm(),AP.bindShippingMethodChange(),AP.bindShippingCountryChangeLink(),AP.bindEuShippingHelpLayer(),AP.sortSelectElementOptions(),AP.bindBillingCountryChange(),AP.bindShippingCountryChange(),AP.bindPostalCodeChange(),AP.bindPhoneFormatting(),AP.bindPaymentFormatting(),AP.bindPayPalButton(),AP.bindGiftCardHooks(),AP.scrollOnLoad()},scrollOnLoad:function(){var scrollto=$.getUrlVar("goto");if("undefined"!=typeof scrollto){var selector="";switch(scrollto){case"shipping":selector=$("#billAsShipToggle").is(":checked")?"#billingFirstName":"#shippingFirstName";break;case"billing":selector="#billingFirstName";break;case"payment":selector="#ccnumber";break;case"user":selector="#inputFirstName"}selector.length&&(CLIENT.Checkout.AddressPayment.focusAndScrollTo(selector),CLIENT.Settings.gaEnhancedEC&&ga.loaded&&(ga("ec:setAction","checkout_option",{step:2,option:"Edit: "+selector.replace("#","")}),ga("send","event","Checkout","Option")))}else{var firstMessage=$("label.error-message:visible:first"),firstErrorInput=$("label.error-message:visible:first").prev("input");0!=firstErrorInput.length?(CLIENT.util.scrollToObject(firstErrorInput),CLIENT.Settings.gaEnhancedEC&&ga.loaded&&(ga("ec:setAction","checkout_option",{step:2,option:"Error: "+firstErrorInput.attr("name")}),ga("send","event","Checkout","Option"))):0!=firstMessage.length&&CLIENT.util.scrollToObject(firstMessage)}},bindContinueShopping:function(){$("#cartbacktoshopmobile, #cartbacktoshop").on("click",function(e){if(CLIENT.Settings.gaEnhancedEC&&ga.loaded){e.preventDefault();var url=$(this).attr("href");try{ga("ec:setAction","checkout_option",{step:2,option:"Continue Shopping"}),ga("send","event","Checkout","Option",{hitCallback:function(){document.location.href=url}})}catch(e){document.location.href=url}}})},bindShippingMethodChange:function(){$(":radio[id^='cartshipmethod']").on("change",function(){if(CLIENT.Settings.gaEnhancedEC&&ga.loaded)try{var value=$(this).data("data-shipmethod");ga("ec:setAction","checkout_option",{step:2,option:"Ship Method: "+value}),ga("send","event","Checkout","Option")}catch(e){}})},sortSelectElementOptions:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.sortSelectElementOptions"),$("#billingCountrySelect,#shippingCountrySelect").each(function(){var selectedValue=$(this).val();$(this).html($("option",$(this)).sort(function(a,b){var repA=CLIENT.util.strReplaceAccents(a.text),repB=CLIENT.util.strReplaceAccents(b.text);return repA==repB?0:repB>repA?-1:1})),$(this).val(selectedValue)})},bindEuShippingHelpLayer:function(){$("#euShippingHelpIcon").on("click",function(){return $(".euShippingMessage").toggle(),!1})},bindSeeWhyDataChanges:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.bindSeeWhyDataChanges"),"undefined"!=typeof CLIENT.SeeWhy&&($("#loginUserName, #inputEmail").on("change",function(){var val=$.trim($(this).val());0!=val.length&&CLIENT.Base.isValidEmail(val)&&(CLIENT.SeeWhy.userEmail=val,CLIENT.SeeWhy.cyEvent(4))}),$("#inputFirstName, #billingFirstName").on("change",function(){var val=$.trim($(this).val());0!=val.length&&(CLIENT.SeeWhy.userName=val,CLIENT.SeeWhy.cyEvent(4))}))},bindTogglePasswordInputs:function(){$("#create_account").on("change",function(){CLIENT.Checkout.AddressPayment.togglePasswordInputs()})},togglePasswordInputs:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.togglePasswordInputs");var wrapper=$(".password-wrapper");wrapper.toggle(),wrapper.is(":visible")?(wrapper.find("input").each(function(){$(this).removeAttr("disabled")}),$("#generatePassword").focus(),$("#inputEmail").trigger("keyup")):(wrapper.find("input").each(function(){$(this).attr("disabled","disabled")}),$("#inputEmail").trigger("keyup"))},bindToggleBillAsShip:function(){$("#billAsShipToggle").on("change",function(){$.Log.debug("toggle bill as ship"),CLIENT.Checkout.AddressPayment.toggleBillAsShip()})},toggleBillAsShip:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.toggleBillAsShip");var wrapper=$("#shippingAddressWrapper");wrapper.toggle(),wrapper.is(":visible")?($("#zo_use_bill_as_ship").val("0"),CLIENT.Checkout.AddressPayment.setShippingAsEmpty(),CLIENT.Checkout.AddressPayment.clearShippingErrorLabels()):($("#zo_use_bill_as_ship").val("1"),CLIENT.Checkout.AddressPayment.clearShippingErrorLabels(),CLIENT.Checkout.AddressPayment.setShippingFromBilling())},bindToggleGiftCardForm:function(){$("#gift-card-button").on("click touchstart",function(e){$.Log.debug("toggle gift card form"),e.preventDefault(),CLIENT.Checkout.AddressPayment.toggleGiftCard()})},bindToggleGiftReceipt:function(){$("#zo_value_GIFT_RECEIPT-0").on("change",function(){CLIENT.Checkout.AddressPayment.toggleGiftReceipt()})},toggleGiftReceipt:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.toggleGiftReceipt");var wrapper=$(".gift-receipt");wrapper.toggle(),wrapper.is(":visible")?wrapper.find(":input[name^='zo_value_GIFT_RECEIPT']").attr("disabled","disabled"):wrapper.find(":input[name^='zo_value_GIFT_RECEIPT']").removeAttr("disabled")},modifyFormLinks:function(bool,timeout){var paymentFormLinks=$("#addressPaymentForm").find(".submitlink");paymentFormLinks.prop("disabled",bool),"undefined"!=typeof timeout&&setTimeout(function(){paymentFormLinks.prop("disabled",!bool)},1e3*timeout)},bindPrimaryFormSubmit:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.bindPrimaryFormSubmit");var paymentForm=$("#addressPaymentForm");paymentForm.find("#submitPaymentForm").on("click touchstart",function(){paymentForm.find(":input[name='OPTION']").val("ADDRESS_PAYMENT")}),paymentForm.scrupulous({beforeSubmit:function(){$.Log.debug("#addressPaymentForm.scrupulous.beforeSubmit"),CLIENT.Checkout.AddressPayment.modifyFormLinks(!0,20),CLIENT.Checkout.AddressPayment.validateShippingMethod();try{var hiddenEmail=$("#billingEmail"),ef=$.trim(hiddenEmail.val());(0==ef.length||"GUEST"==ef)&&(hiddenEmail.val($.trim($("#inputEmail").val())),hiddenEmail.removeClass("invalid").parents("#billingAddressWrapper").removeClass("has-error"))}catch(err){}var hasGiftCard=!1,giftcards=$(".nix-gift-card-container").find(":input[id^='zo_gift_card_number-']:visible");0!=giftcards.length&&giftcards.each(function(){0!=$.trim($(this).val()).length&&(hasGiftCard=!0)}),hasGiftCard&&0==$.trim($("#ccnumber").val()).length&&CLIENT.Checkout.AddressPayment.disableCreditCardFields(),CLIENT.Checkout.AddressPayment.useBillForShip()&&(CLIENT.Checkout.AddressPayment.clearShippingErrorLabels(),CLIENT.Checkout.AddressPayment.setShippingFromBilling())},setErrorMessage:function(el){if("undefined"!=typeof el){var input=$(el),message=null;if(0!=input.length){var tag=el.tagName.toLowerCase(),type="input"==tag?input.attr("type").toLowerCase():"select"==tag?"select":"unknown";"number"==type?0==input.val().length?message=input.attr("title"):"undefined"!=typeof input.attr("max")&&input.attr("max")<input.val()?message="Please enter "+input.attr("max")+" or less":"undefined"!=typeof input.attr("min")&&input.attr("min")>input.val()&&(message="Please enter "+input.attr("min")+" or more"):"password"==type&&(0==input.val().length?message=input.attr("title"):input.val().length<6&&(message="Please enter at least 6 chars")),null!==message&&el.setCustomValidity(message)}}},valid:function(){if($.Log.debug("Scrupulous says that the addressPaymentForm is valid"),CLIENT.Checkout.AddressPayment.newsLetterSignup(),"undefined"==typeof $("#ccnumber").attr("disabled")&&$("#ccnumber").length>0&&"PAYPAL"!=$("#paymenttype").val()){var continueSubmit=CLIENT.Checkout.AddressPayment.validateCreditCard($("#ccnumber"));if(1!=continueSubmit)return CLIENT.Checkout.AddressPayment.modifyFormLinks(!1),!1}var country=$("#shippingCountry").val();if("AU"==country)var hasPOBox=!1;else var hasPOBox=CLIENT.Checkout.AddressPayment.checkShippingStreetChange();var hasMilAddr=CLIENT.Checkout.AddressPayment.checkShippingCityChange();if(hasPOBox||hasMilAddr){var firstError=$("label.error-message:visible:first");return 0!=firstError.length&&CLIENT.util.scrollToObject(firstError,40),$.Log.error("Failing due to PO box in shipping address: "+$("#shippingStreet1").val()),CLIENT.Checkout.AddressPayment.modifyFormLinks(!1),!1}return!0},invalid:function(){if($.Log.error("addressPaymentForm invalid "+CLIENT.Checkout.AddressPayment.mapInvalidFields()),CLIENT.Checkout.AddressPayment.enableCreditCardForm(),CLIENT.Checkout.AddressPayment.modifyFormLinks(!1),"1"==$("#zo_use_bill_as_ship").val()){var shipErrors=$("#shippingAddressWrapper").find(":input.invalid:first");shipErrors.length&&(CLIENT.Checkout.AddressPayment.toggleBillAsShip(),CLIENT.util.scrollToObject(shipErrors))}return!1}})},mapInvalidFields:function(){try{var invalidFields=$("#addressPaymentForm").find(":input.invalid"),o=[];return invalidFields.each(function(){var i=$(this);o.push(i.attr("name"))}),JSON.stringify(o)}catch(e){return"{error}"}},toggleSignupFields:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.toggleSignupFields");var shouldSignup=$(this).hasClass("checked"),form=$("#addressPaymentForm"),signupEl=form.find("#email_signup_confirm");shouldSignup?signupEl.removeAttr("disabled").val("TRUE"):signupEl.attr("disabled","disabled").val("FALSE"),CLIENT.Checkout.AddressPayment.newsLetterSignup()},newsLetterSignup:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.newsLetterSignup");var form=$("#addressPaymentForm"),signupEl=form.find("#email_signup_confirm"),signupUser=!signupEl.is(":disabled");if(signupUser){form.find(':input[name^="zin_"]').removeAttr("disabled");var zinEmail=form.find(':input[name="zin_value_EMAIL-1"]'),zinFullname=form.find(':input[name="zin_value_FULLNAME-1"]'),zinZipcode=form.find(':input[name="zin_value_ZIPCODE-1"]'),srcEmail=$.trim(form.find(':input[name="email"]').val()),srcFirstname=$.trim(form.find(':input[name="first_name"]').val()),srcLastname=$.trim(form.find(':input[name="last_name"]').val()),srcZipcode=$.trim(form.find(':input[name="zo_bill_postal_code"]').val());srcEmail.length&&zinEmail.val(srcEmail);var fullname="";srcFirstname.length&&(fullname=srcFirstname+" "),srcLastname.length&&(fullname+=srcLastname),fullname=$.trim(fullname),fullname.length&&zinFullname.val(fullname),srcZipcode.length&&zinZipcode.val(srcZipcode)}else form.find(':input[name^="zin_"]').attr("disabled","disabled")},bindAboutYouElements:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.bindAboutYouElements"),$(".nix-checkout-container").on("click",".about-you-navigation",function(){var button=$(this);if(!button.hasClass("clicked")){var wrapper=$(".nix-checkout-container"),target=button.attr("data"),parent=button.closest(".checkout-about-you");parent.find(".about-you-navigation").removeClass("clicked"),button.addClass("clicked"),"guest"==target?(wrapper.find(".checkout-about-you.user").hide(),CLIENT.Checkout.AddressPayment.resetLoginForm(),wrapper.find(".checkout-about-you.guest").show(),CLIENT.Checkout.AddressPayment.focusOnFirstEmptyInput(wrapper.find(".checkout-about-you.guest")),CLIENT.Settings.gaEnhancedEC&&ga.loaded&&(ga("ec:setAction","checkout_option",{step:2,option:"Display Guest Form"}),ga("send","event","Checkout","Option"))):"user"==target&&(wrapper.find(".checkout-about-you.guest").hide(),wrapper.find(".checkout-about-you.user").show(),CLIENT.Checkout.AddressPayment.focusOnFirstEmptyInput(wrapper.find(".checkout-about-you.user")),CLIENT.Settings.gaEnhancedEC&&ga.loaded&&(ga("ec:setAction","checkout_option",{step:2,option:"Display Login Form"}),ga("send","event","Checkout","Option")))}}),$("#logoutLink").on("click",function(e){if(CLIENT.Settings.gaEnhancedEC&&ga.loaded){e.preventDefault();var url=$(this).attr("href");ga("ec:setAction","checkout_option",{step:2,option:"Logout Clicked"}),ga("send","event","Checkout","Option",{hitCallback:function(){document.location.href=url}})}})},focusOnFirstEmptyInput:function(wrapper){wrapper.length&&wrapper.find(":input:visible:not(:button), :checkbox:not(:checked):first").filter(function(){return 0==$.trim($(this).val().length)}).first().focus()},resetLoginForm:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.resetLoginForm");var form=$("#cartloginform");form.find(".secondary").removeClass("has-error").removeClass("has-success"),form.find("label.error-message").remove(),form.find("#loginUserName").removeClass("invalid"),form.find("#loginPassword").removeClass("invalid")},cancelLogin:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.cancelLogin"),$("#guestCheckoutLink").trigger("click")},bindGiftMessageCount:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.bindGiftMessageCount");var container=$(".nix-checkout-container"),textArea=container.find(".checkout-gift"),messageBox=container.find(".for-gift-receipt-count");textArea.keyup(function(){var l=250-$(this).val().length;messageBox.html(l+" "+messageBox.attr("data-remaining"))})},hidePayPalCheckout:function(){var link=$("#paypal-button");link.attr("disabled","disabled").addClass("disabled")},showPayPalCheckout:function(){var link=$("#paypal-button");link.removeAttr("disabled").removeClass("disabled")
},showHidePayPalCheckoutGCUpdate:function(){var hasGiftCard=!1,giftcards=$(":input[name='gift_card_number']:visible");0!=giftcards.length&&giftcards.each(function(){0!=$.trim($(this).val()).length&&(hasGiftCard=!0)}),hasGiftCard?CLIENT.Checkout.AddressPayment.hidePayPalCheckout():CLIENT.Checkout.AddressPayment.showPayPalCheckout()},pwCloseRequiresReload:!1,initRecoverPasswordLink:function(){$(".lostpassword").fancybox({fitToView:!1,autoSize:!0,width:360,height:300,scrolling:"no"})},initPWRecoveryForm:function(){$("#nix-forgotpassword").scrupulous({valid:function(){CLIENT.Settings.gaEnhancedEC&&ga.loaded&&(ga("ec:setAction","checkout_option",{step:2,option:"Forgot Password Submitted"}),ga("send","event","Checkout","Option"))}}),$("#cancelpasswdreq").click(function(){CLIENT.Modal.forceClosedModal()})},bindForgotPasswdLink:function(){$("a.forgot-password").on("click",function(){CLIENT.Settings.gaEnhancedEC&&ga.loaded&&(ga("ec:setAction","checkout_option",{step:2,option:"Forgot Password Clicked"}),ga("send","event","Checkout","Option"))})},bindForgotPasswdSubmit:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.bindForgotPasswdSubmit"),$(".nix-overlay-body").on("submit","#nix-forgotpassword",function(){var parms=$("#nix-forgotpassword").serialize(),url=$("#nix-forgotpassword").attr("action"),emailName="email",emailAddress=$.trim($("#nix-forgotpassword").find("#pwResetEmail").val()),errors={};return $.ajax({url:url,crossDomain:!0,asynch:!1,type:"GET",dataType:"jsonp",data:parms,xhrFields:{withCredentials:!0}}).done(function(o){"object"==typeof o?"email_sent"!=o.status?(errors[emailName]=CLIENT.Settings.alerts.signin[o.status],CLIENT.Checkout.AddressPayment.setValidatorMessages(errors)):($("#nix-forgotpassword-container").replaceWith(CLIENT.Settings.alerts.signin[o.status]),$("#loginUserName").val(emailAddress)):(errors[emailName]=CLIENT.Settings.alerts.signin.error,CLIENT.Checkout.AddressPayment.setValidatorMessages(errors)),CLIENT.util.enableButton("send-submit")}).fail(function(){errors[emailName]=CLIENT.Settings.alerts.signin.error,CLIENT.Checkout.AddressPayment.setValidatorMessages(errors),CLIENT.util.enableButton("send-submit")}),!1})},checkUseridAvail:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.checkUseridAvail");var input=$(this),id=(input.attr("name"),$.trim(input.val())),createAccount=$("#create_account").is(":checked");if(0!=id.length&&createAccount)if("undefined"==typeof CLIENT.Cache.orderValues.useridcheck&&(CLIENT.Cache.orderValues.useridcheck={}),"undefined"==typeof CLIENT.Cache.orderValues.useridcheck[id])$.ajax({url:CLIENT.Settings.getServlet(),type:"GET",dataType:"jsonp",data:{OPTION:"CHECK_USERID_AVAIL",userid:id}}).done(function(response){CLIENT.Cache.orderValues.useridcheck[response.userid]=response,response.userexists&&CLIENT.Checkout.AddressPayment.throwUsernameExistsError()});else{var rv=CLIENT.Cache.orderValues.useridcheck[id].userexists;rv&&CLIENT.Checkout.AddressPayment.throwUsernameExistsError()}},throwUsernameExistsError:function(){var input=$("#inputEmail");input.addClass("invalid").removeClass("valid");var error=input.siblings(".error-message");error.length?error.html(CLIENT.Settings.alerts.checkout.userAlreadyExists).show():(input.after("<label class='error-message' for='inputEmail'>"+CLIENT.Settings.alerts.checkout.userAlreadyExists+"</label>"),input.removeClass("valid").addClass("invalid"),input.parent(".form-group").removeClass("has-success").addClass("has-error"))},checkShippingStreetChange:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.checkShippingStreetChange");var sInput=$("#shippingStreet1"),bInput=$("#billingStreet1"),useInput=bInput;return CLIENT.Checkout.AddressPayment.useBillForShip()||(useInput=sInput),CLIENT.Checkout.AddressPayment.checkForPOBox(useInput)},checkShippingCityChange:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.checkShippingCityChange");var sInput=$("#shippingCity"),bInput=$("#billingCity"),useInput=bInput;return CLIENT.Checkout.AddressPayment.useBillForShip()||(useInput=sInput),!useInput.length&&bInput.length&&(useInput=bInput),CLIENT.Checkout.AddressPayment.checkForAPOFPO(useInput)},checkForAPOFPO:function(o){$.Log.debug("CLIENT.Checkout.AddressPayment.checkForAPOFPO");try{var zval="",cval=o.val(),inputName=o.attr("name");if(zval=inputName.indexOf("billing")?$("#billingPostalCode").val():$("#shippingPostalCode").val(),CLIENT.Checkout.Confirm.hasMilitaryAddress(cval,zval)){$.Log.error("Throwing Error: APO/FPO: city='"+cval+"' zip='"+zval+"'");var errors={};return errors[inputName]=CLIENT.Settings.alerts.checkout.MilitaryAddressError,CLIENT.Checkout.AddressPayment.throwValidatorError(errors),!0}}catch(e){$.Log.erorr("Error in CLIENT.Checkout.AddressPayment.checkForAPOFPO: "+e)}return!1},checkForPOBox:function(o){$.Log.debug("CLIENT.Checkout.AddressPayment.checkForPOBox");var val=o.val(),inputName=o.attr("name");if("undefined"!=typeof val&&0!=val.length&&CLIENT.Checkout.Confirm.hasPostOfficeBox(val)){$.Log.debug("Throwing Error: Address has PO Box");var errors={};return errors[inputName]=CLIENT.Settings.alerts.checkout.POBoxError,CLIENT.Checkout.AddressPayment.throwValidatorError(errors),!0}return!1},validatePasswordOnBlur:function(){var o=$(this),val=o.val(),inputName=o.attr("name"),isValid=CLIENT.Checkout.AddressPayment.checkPasswordFormat(val);if(!isValid){var errors={};errors[inputName]=CLIENT.Settings.alerts.checkout.passwordValidationError,CLIENT.Checkout.AddressPayment.throwValidatorError(errors)}},validatePasswordOnEntry:function(){{var o=$(this),val=o.val();CLIENT.Checkout.AddressPayment.checkPasswordFormat(val)}},checkPasswordFormat:function(val){return CLIENT.Base.isValidPassword(val)?!0:CLIENT.Base.isWarmPassword(val)?!1:CLIENT.Base.isColdPassword(val)?!1:!1},switchPaymentType:function(){var type=$(this).val();"CC"==type?CLIENT.Checkout.AddressPayment.enableCreditCardForm():"COD"==type&&CLIENT.Checkout.AddressPayment.disableCreditCardForm()},disableCreditCardForm:function(){$("#ccnumber, #cvvcode, #ccexpmonth, #ccexpyear").removeAttr("required").attr("disabled","disabled"),$("#creditCardPaymentData").slideFade(function(){})},enableCreditCardForm:function(){$("#ccnumber, #cvvcode, #ccexpmonth, #ccexpyear").attr("required","required").removeAttr("disabled"),$("#creditCardPaymentData").slideFade(function(){})},bindBillingCountryChange:function(){$("#billingCountrySelect").on("change",function(){CLIENT.Base.countrySetStates($(this)),$("#billingCountry").val($(this).val());var shippingWrapper=$("#shippingAddressWrapper");shippingWrapper.is(":hidden")&&($("#zo_use_bill_as_ship").val("0"),$("#useBillAsShipWrapper").hide(),$("#billAsShipToggle").attr({disabled:!0,checked:!1}),CLIENT.Checkout.AddressPayment.setShippingAsEmpty(),CLIENT.Checkout.AddressPayment.clearShippingErrorLabels(),shippingWrapper.slideFade(function(){$("#shippingFirstName").focus().select()}))})},bindShippingCountryChange:function(){$("#shippingCountrySelect").on("change",function(){CLIENT.Base.countrySetStates($(this)),$("#shippingCountry").val($(this).val())})},bindPostalCodeChange:function(){$("#billingPostalCode").on("keyup input",$.debounce(250,CLIENT.Checkout.AddressPayment.zipCodeLookup)).on("keydown",CLIENT.Checkout.Cart.limitZipCodeKeyPress),$("#shippingPostalCode").on("keyup input",$.debounce(250,CLIENT.Checkout.AddressPayment.zipCodeLookup)).on("keydown",CLIENT.Checkout.Cart.limitZipCodeKeyPress)},bindPhoneFormatting:function(){var billingPhoneInput=$("#billingPhone");"en_US"==CLIENT.Settings.locale.code?($.Log.debug("CLIENT.Checkout.AddressPayment.bindPhoneFormatting : en_US"),billingPhoneInput.usphone(),billingPhoneInput.trigger("keyup")):"en_AU"==CLIENT.Settings.locale.code&&($.Log.debug("CLIENT.Checkout.AddressPayment.bindPhoneFormatting : en_AU"),billingPhoneInput.auphone(),billingPhoneInput.trigger("keyup")),billingPhoneInput.on("input",$.debounce(100,function(){billingPhoneInput.trigger("keyup")}))},bindPaymentFormatting:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.bindPaymentFormatting");var ccnumInput=$("#ccnumber");ccnumInput.formatcc("format_credit_card_number"),ccnumInput.on("focus",CLIENT.Checkout.AddressPayment.showCreditCard).on("keyup",$.debounce(200,CLIENT.Checkout.AddressPayment.checkCreditCard)).on("blur",CLIENT.Checkout.AddressPayment.validateCreditCard),$("#ccexpmonth, #ccexpyear").on("change blur",CLIENT.Checkout.AddressPayment.mergeCCDate),$("#toggleGiftReceipt").on("change input",CLIENT.Checkout.AddressPayment.activateGiftMsg),$("input[name='PAYMENT_TYPE']").click(CLIENT.Checkout.AddressPayment.switchPaymentType)},bindPayPalButton:function(){$("#paypal-button").on("click",function(){CLIENT.Settings.gaEnhancedEC&&ga.loaded?(ga("ec:setAction","checkout_option",{step:2,option:"Payment: PayPal"}),ga("send","event","Checkout","Option",{hitCallback:function(){CLIENT.Checkout.AddressPayment.payPalCheckout()}})):CLIENT.Checkout.AddressPayment.payPalCheckout()})},bindGiftCardHooks:function(){$("#gcCheckBalances").click(CLIENT.Checkout.AddressPayment.checkGiftCardBalances),$("#gcQuantity").on("change",$.debounce(100,CLIENT.Checkout.AddressPayment.changeGiftCardFields)),$("#giftCardWrapper").on("keyup","input[id^='zo_gift_card_number']",function(){CLIENT.Checkout.AddressPayment.checkGiftCardNumberFormat.call($(this)),CLIENT.Checkout.AddressPayment.showHidePayPalCheckoutGCUpdate(),CLIENT.Checkout.AddressPayment.clearGiftCardErrors()})},focusAndScrollTo:function(field){if($.Log.debug("CLIENT.Checkout.AddressPayment.focusAndScrollTo"),"undefined"!=typeof field){var o=$(field);0!=o.length&&("undefined"!=typeof o.attr("id")&&CLIENT.util.scrollToId(o.attr("id")),o.focus())}},changeGiftCardFields:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.changeGiftCardFields");var count=$(this).val(),itemWrapper=$(".giftCardItems"),currentItems=$(".giftCardItem"),currentLength=currentItems.length;if(count!=currentLength)if(currentLength>count)for(x=currentLength;x>count;x--)$(currentItems[x-1]).remove();else for(x=currentLength+1;x<=count;x++){var newCard=$(currentItems[0]).clone(!0),numberField=newCard.find("input[id^='zo_gift_card_number']"),tabindex=Number(numberField.attr("tabindex"))+2*x-2;numberField.val("").attr({id:"zo_gift_card_number-"+x,tabindex:tabindex}).trigger("keyup"),newCard.find("label.error").remove(),newCard.find(".giftcard-balance").remove(),itemWrapper.append(newCard);var placeholderText=$.trim(newCard.find("input").attr("placeholder")),placeholderTrunc=placeholderText.slice(0,-1);placeholderText=placeholderTrunc+x,newCard.find("input").attr("placeholder",placeholderText)}},checkCreditCard:function(input){$.Log.debug("CLIENT.Checkout.AddressPayment.checkCreditCard");var val,num,type,o=$("undefined"!=typeof input?input.target:this);val=o.val(),num=val.replace(/[^\d-\s]/g,""),type=CLIENT.Checkout.AddressPayment.checkCreditCardType(num),CLIENT.Checkout.AddressPayment.highlightCardIcon(type,!1)},checkCreditCardType:function(num){$.Log.debug("CLIENT.Checkout.AddressPayment.checkCreditCardType");var cardpatterns={};return $(".ccicons").find("span").each(function(){var type=$(this).attr("data-cardtype");"Visa"==type?cardpatterns.Visa=/^4[0-9]{0,12}(?:[0-9]{3})?$/:"MasterCard"==type?cardpatterns.MasterCard=/^5[1-5][0-9]{0,14}$/:"Discover"==type?cardpatterns.Discover=/^6(?:011|5[0-9]{2})[0-9]{0,12}$/:"JCB"==type?cardpatterns.JCB=/^(?:2131|1800|35\d{3})\d{0,11}$/:"Diners"==type?cardpatterns.Diners=/^3(?:0[0-5]|[68][0-9])[0-9]{0,11}$/:"American Express"==type&&(cardpatterns["American Express"]=/^3[47][0-9]{0,13}$/)}),CLIENT.Checkout.AddressPayment.getCreditCardType(cardpatterns,num)},checkGiftCardBalances:function(){if($.Log.debug("CLIENT.Checkout.AddressPayment.checkGiftCardBalances"),!CLIENT.Checkout.AddressPayment.hasGiftCards())return!1;var giftCards=$(".giftCardItem"),form=$("<form/>").attr({action:CLIENT.Settings.url.secureHost+"/cart/address-payment/",id:"GiftCardBalanceCheckForm",method:"POST"});for(form.append($("<input type='hidden' name='OPTION' value='GIFTCARD_CHECKOUT_PAGE_BALANCE_CHECK'/>")),x=0;x<giftCards.length;x++){var idField=$(giftCards[x]).find("input[id^='zo_gift_card_number']"),gcnel=$(idField).clone();gcnel.attr("id",gcnel.attr("id")+"bal");var gcn=CLIENT.Checkout.AddressPayment.checkGiftCardValues(gcnel);gcn&&form.append(gcnel)}$("body").append(form),form.submit()},checkGiftCardNumberFormat:function(){var i=$(this),val=i.val();if(-1==val.indexOf("*")){var cleanval=CLIENT.Base.digitOnly(val);cleanval.length>21&&(cleanval=cleanval.substr(0,21)),i.val(cleanval)}},clearGiftCardErrors:function(){var wrapper=$(".nix-gift-card-container"),gcsWithValues=wrapper.find(":input[id^='zo_gift_card_number-']").filter(function(){return 0!=$(this).val().length});0==gcsWithValues.length&&wrapper.find(".error-message").remove()},checkGiftCardValues:function(input){$.Log.debug("CLIENT.Checkout.AddressPayment.checkGiftCardValues");var val=input.val();if(-1==val.indexOf("*")){{var cleanval=CLIENT.Base.digitOnly(val);input.attr("name")}if(0==$.trim(input.val()).length)return input.addClass("error"),!1;if(val!=cleanval)return input.addClass("error"),!1;if(val.length>21)return input.addClass("error"),!1}return input.removeClass("error"),input.val()},clearShippingAddressFields:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.clearShippingAddressFields"),$("#shippingFirstName").val("").trigger("keyup"),$("#shippingLastName").val("").trigger("keyup"),$("#shippingCompany").val("").trigger("keyup"),$("#shippingStreet1").val("").trigger("keyup"),$("#shippingCity").val("").trigger("keyup"),$("#shippingState").val("").trigger("keyup"),$("#shippingPostalCode").val("").trigger("keyup")},disableCreditCardFields:function(){var paymentFields=$("input, select","#creditCardFormFields").not("[name^='zop_card_type-']");paymentFields.each(function(){$(this).attr("disabled","disabled"),CLIENT.Checkout.AddressPayment.setFormElementValid($(this))})},duplicateUserEmail:function(){var email=$.trim($(this).val());$("#billingEmail").val(email).removeClass("invalid").parents("#billingAddressWrapper").removeClass("has-error"),$("#loginUserName").val(email).trigger("keyup")},getCreditCardType:function(patterns,val){$.Log.debug("CLIENT.Checkout.AddressPayment.getCreditCardType"),val=val.replace(/[^\d]/g,"");var type=null;for(type in patterns)if(patterns[type].test(val))return type;return"unknown"},getSerializedGiftCardString:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.getSerialized");var data="",giftCards=$(".giftCardItem"),hasErrors=!1;for(x=0;x<giftCards.length;x++){var gcnel=$(giftCards[x]).find("input[id^='zo_gift_card_number']"),gcn=CLIENT.Checkout.AddressPayment.checkGiftCardValues(gcnel);gcn?data+="&zo_gift_card_number="+gcn:hasErrors=!0}return hasErrors?!1:data},hasGiftCards:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.hasGiftCards");var giftCards=$(".giftCardItem");if(0==giftCards.length)return!1;for(x=0;x<giftCards.length;x++){var gcnel=$(giftCards[x]).find("input[id^='zo_gift_card_number']"),gcn=CLIENT.Checkout.AddressPayment.checkGiftCardValues(gcnel);if(gcn)return!0}return!1},highlightCardIcon:function(type,showInvalid){$.Log.debug("CLIENT.Checkout.AddressPayment.highlightCardIcon"),$(".payment-icon").not("[data-cardtype='"+type+"']").removeClass("active"),$(".payment-icon[data-cardtype='"+type+"']").addClass("active");var carteBleueIcon=$("#ccCarteBleue");carteBleueIcon.length&&("MasterCard"==type||"Visa"==type||"American Express"==type?carteBleueIcon.addClass("active"):carteBleueIcon.removeClass("active")),$("#paymenttype").val("unknown"===type?"":type)},isMasked:function(s){$.Log.debug("CLIENT.Checkout.AddressPayment.isMasked");var maskRegex=/^xxxx.*$/i;return maskRegex.test(s)},bindGuestFormElements:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.bindGuestFormElements"),$("#inputEmail").on("input keyup",$.debounce(250,CLIENT.Checkout.AddressPayment.duplicateUserEmail)).on("input keyup",$.debounce(1e3,CLIENT.Checkout.AddressPayment.checkUseridAvail)).on("input keyup",$.debounce(1e3,CLIENT.Checkout.AddressPayment.newsLetterSignup)),$("#inputFirstName").on("input keyup",$.debounce(250,CLIENT.Checkout.AddressPayment.copyFirstLastToAddress)),$("#inputLastName").on("input keyup",$.debounce(250,CLIENT.Checkout.AddressPayment.copyFirstLastToAddress))},copyFirstLastToAddress:function(){var from=$(this),to=$("#"+from.attr("id").replace("input","billing")),toship=$("#"+from.attr("id").replace("input","shipping"));to.val(from.val()).trigger("input"),toship.val(from.val()).trigger("input")},bindLoginForm:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.bindLoginForm"),$("#cartloginform").scrupulous({parentClassName:"secondary",valid:function(){return $.Log.debug("I'm a valid form"),!0},invalid:function(){return $.Log.debug("I'm an invalid form"),!1}}),$("#submitLoginRequest").on("click",function(){$("#cartloginform").submit()}),$("#cancelLoginSubmit").on("click",CLIENT.Checkout.AddressPayment.cancelLogin),$("#loginPassword").on("keypress",function(e){var el=$("#loginError");el.is(":visible")&&el.hide(0),13==e.which&&(e.preventDefault(),e.stopPropagation(),$("#submitLoginRequest").trigger("click"))})},luhnCheck:function(cardNumStr){if($.Log.debug("CLIENT.Checkout.AddressPayment.luhnCheck"),cardNumStr=cardNumStr.replace(/[-\s]/g,""),cardNumStr.match(/\D/g))return!1;if(cardNumStr.length<14)return!1;var revCardNumStr=cardNumStr.split("").reverse().join(""),checkStr="",i=0;for(i=0;i<revCardNumStr.length;i++)checkStr+=i%2===1?2*parseInt(revCardNumStr.charAt(i),10):parseInt(revCardNumStr.charAt(i),10);var checkSum=0,i=0;for(i=0;i<checkStr.length;i++)checkSum+=parseInt(checkStr.charAt(i),10);return checkSum%10===0},mergeCCDate:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.mergeCCDate"),expDateVal=$("#ccexpmonth").val()+"/"+$("#ccexpyear").val(),expDateLength=expDateVal.length,$("#ccexpdate").val(7==expDateLength?$("#ccexpmonth").val()+"/"+$("#ccexpyear").val():"")},payPalCheckout:function(){if($.Log.debug("CLIENT.Checkout.AddressPayment.payPalCheckout"),CLIENT.Checkout.AddressPayment.hasGiftCards())return!1;var addressForm=$("#addressPaymentForm");CLIENT.Checkout.AddressPayment.newsLetterSignup(),addressForm.find("input[name='OPTION']").val("ADDRESS_PAYPAL"),addressForm.find("#paymenttype").val("PAYPAL"),CLIENT.Checkout.AddressPayment.disableCreditCardFields(),CLIENT.Checkout.AddressPayment.useBillForShip()&&CLIENT.Checkout.AddressPayment.setShippingFromBilling(),addressForm.submit()},setBillingAddressFromUser:function(){if($.Log.debug("CLIENT.Checkout.AddressPayment.setBillingAddressFromUser"),"object"==typeof(address=CLIENT.User.userView.billingAddress[0])){var email=CLIENT.User.userView.email,userid=CLIENT.User.userView.userid;if("object"==typeof address.phone.PHONE[0])var phone=address.phone.PHONE[0];$("input[name='zo_bill_userid']").val(userid),$("input[name='zo_bill_userid']").val(userid),$("#billingEmail").val(email),$("#billingFirstName").val(address.firstName).trigger("keyup"),$("#billingMiddleInitial").val(address.middleName).trigger("keyup"),$("#billingLastName").val(address.lastName).trigger("keyup"),$("#billingCompany").val(address.company).trigger("keyup"),$("#billingStreet1").val(address.street1).trigger("keyup"),$("#billingCity").val(address.city).trigger("keyup"),$("#billingState").val(address.state).trigger("keyup"),$("#billingPostalCode").val(address.postalCode).trigger("keyup"),$("#billingCountry").val(address.countryCode).trigger("keyup"),phone&&$("#billingPhone").val(phone.number).trigger("keyup")}},setLoginFromUser:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.setLoginFromUser"),$("#userFirstName").html(CLIENT.User.userView.firstname),$("#userLastName").html(CLIENT.User.userView.lastname),$("#userEmail").html(CLIENT.User.userView.userid)},clearShippingErrorLabels:function(){$("#shippingAddressWrapper").find(".form-group").each(function(){$(this).removeClass("has-success").removeClass("has-error").find(":input").removeClass("invalid").removeClass("valid"),$(this).find("label.error-message").remove()})},setShippingAsEmpty:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.setShippingAsEmpty");var value,name,osname,o,os,billForm=$("*[name^='zo_bill_']");billForm.each(function(){o=$(this),value=o.val(),name=o.attr("name"),osname=name.replace("zo_bill_","zo_ship_"),os=$("*[name='"+osname+"']"),os.length&&(-1!=osname.indexOf("first_name")||-1!=osname.indexOf("last_name")?($.Log.debug("Setting "+osname+" to: "+value,null,"DEBUG"),os.val(value).trigger("keyup").trigger("change")):-1!=osname.indexOf("country_code")||-1!=osname.indexOf("CountryHolder")||($.Log.debug("Clearing value for "+osname,null,"DEBUG"),os.val("").trigger("keyup").removeClass("error")))})},setShippingFromBilling:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.setShippingFromBilling");var value,name,osname,o,os,billForm=$("*[name^='zo_bill_']");billForm.each(function(){o=$(this),value=o.val(),name=o.attr("name"),osname=name.replace("zo_bill_","zo_ship_"),os=$("*[name='"+osname+"']"),os.length&&($.Log.debug("Setting "+osname+" to: "+value,null,"DEBUG"),os.val(value).trigger("keyup").trigger("change"))})},selectJapanShippingMethod:function(){var state=$("#shippingState").val(),i=0;for(i=0;i<CLIENT.Cache.JPShipMethods.length;i++){var o=CLIENT.Cache.JPShipMethods[i];if(o.name==state){$("#zo_shipping_method_id").val(o.ID);break}}},setupJapanShipping:function(states){CLIENT.Cache.JPShipMethods=states,CLIENT.Checkout.AddressPayment.selectJapanShippingMethod(),$("#shippingState").on("change",CLIENT.Checkout.AddressPayment.selectJapanShippingMethod)},setValidatorMessages:function(errors){var newMessages={},hasErrors=!1;for(i in errors){var key=i,message=errors[i],keyAr=key.split(".");if(keyAr.length>1)var input=keyAr[1];else var input=keyAr[0];var o=$(":input[name^='"+input+"']");o.length&&(newMessages[o.attr("name")]=message,hasErrors=!0)}hasErrors&&(CLIENT.Checkout.AddressPayment.throwValidatorError(newMessages),setTimeout(function(){var firstError=$("label.error-message:visible:first");0!=firstError.length&&0==firstError.parents(".nix-modal-wrapper").length&&CLIENT.util.scrollToObject(firstError)},250))},showCreditCard:function(input){$.Log.debug("CLIENT.Checkout.AddressPayment.showCreditCard");var o=$("undefined"!=typeof input?input.target:this);CLIENT.Checkout.Order.userCCNum&&o.val(CLIENT.Checkout.Order.userCCNum).trigger("keyup")},toggleGiftCard:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.toggleGiftCard"),$(".nix-gift-card-container").slideFade(),$("#gift-card-button").toggleClass("clicked")},toggleShippingAddress:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.toggleShippingAddress");var shippingAddressWrapper=$("div#shippingAddressWrapper");shippingAddressWrapper.is(":hidden")?($("#zo_use_bill_as_ship").val("0"),CLIENT.Checkout.AddressPayment.setShippingAsEmpty(),CLIENT.Checkout.AddressPayment.clearShippingErrorLabels(),shippingAddressWrapper.show(0,function(){$("#shippingFirstName").focus().select()})):shippingAddressWrapper.show(0,function(){CLIENT.Checkout.AddressPayment.setShippingFromBilling(),$("#zo_use_bill_as_ship").val("1")})},bindShippingCountryChangeLink:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.bindShippingCountryChangeLink"),$("#shipCountryChangeButton").on("click",function(){var countryChangeForm=$("#addressPaymentFormToCartCountrySelection");$("#addressPaymentForm").find(":input").clone().appendTo(countryChangeForm),countryChangeForm.find("input[name=OPTION]").val("ADDRESS_PAYMENT_TO_CART_COUNTRY_SELECT"),countryChangeForm.submit()})},liveCopyBillingToShipping:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.liveCopyBillingToShipping");var wrapper=$("#billingAddressWrapper");wrapper.find("input, select").each(function(){$(this).on("input change keyup",$.debounce(250,function(){if(CLIENT.Checkout.AddressPayment.useBillForShip()){var o=$(this),value=o.val(),id=(o.attr("name"),o.attr("id")),shipId=id.replace("billing","shipping"),os=$("#"+shipId);os.length&&($.Log.debug("Setting #"+shipId+" to: "+value,null,"DEBUG"),o.attr("id")!=shipId&&os.val(value).trigger("keyup").trigger("change"))}}))})},useBillForShip:function(){if($.Log.debug("CLIENT.Checkout.AddressPayment.useBillForShip"),$("#zo_use_bill_as_ship").length>0){var val=$("#zo_use_bill_as_ship").val();return val.length||(val=0),1==Number(val)}},validateCreditCard:function(input){$.Log.debug("CLIENT.Checkout.AddressPayment.validateCreditCard");var val,cleanNum,type,o,isValid=!1;if(o=$("ccnumber"==$(input).attr("id")?input:input.target),val=$.trim(o.val()),0!=val.length){if("xxxx-"==val.substr(0,5))return!0;if("4007000000027"==val)return!0;if("4222222222222"==val)return!0;if(cleanNum=val.replace(/[^\d]/g,""),CLIENT.Checkout.Order.userCCNum=val,CLIENT.Checkout.Order.cleanCCNum=cleanNum,type=CLIENT.Checkout.AddressPayment.validateCreditCardType(cleanNum),isValid=CLIENT.Checkout.AddressPayment.luhnCheck(cleanNum),$.Log.debug("Card is Valid? "+isValid,null,"DEBUG"),CLIENT.Checkout.AddressPayment.highlightCardIcon(type,!isValid),"4222222222222"==CLIENT.Checkout.Order.userCCNum&&(type="Visa",cleanNum=val,isValid=!0),"unknown"!=type&&isValid)return CLIENT.Checkout.AddressPayment.setFormElementValid(o),CLIENT.Settings.gaEnhancedEC&&ga.loaded&&(ga("ec:setAction","checkout_option",{step:2,option:"Payment: "+type}),ga("send","event","Checkout","Option")),!0;var errors={};return"unknown"==type&&(errors["zop_account_number-1"]=CLIENT.Settings.alerts.checkout.unsupportedCreditCardType,CLIENT.Checkout.AddressPayment.throwValidatorError(errors)),errors["zop_account_number-1"]=CLIENT.Settings.alerts.checkout.invalidCreditCardInfo,CLIENT.Checkout.AddressPayment.throwValidatorError(errors),CLIENT.Settings.gaEnhancedEC&&ga.loaded&&(ga("ec:setAction","checkout_option",{step:2,option:"Invalid Card Number Entered"}),ga("send","event","Checkout","Option")),!1}},validateCreditCardType:function(num){$.Log.debug("CLIENT.Checkout.AddressPayment.validateCreditCardType");var cardpatterns={};return $(".ccicons").find("span").each(function(){var type=$(this).attr("data-cardtype");"Visa"==type?cardpatterns.Visa=/^4[0-9]{12}(?:[0-9]{3})?$/:"MasterCard"==type?cardpatterns.MasterCard=/^5[1-5][0-9]{14}$/:"Discover"==type?cardpatterns.Discover=/^6(?:011|5[0-9]{2})[0-9]{12}$/:"JCB"==type?cardpatterns.JCB=/^(?:2131|1800|35\d{3})\d{11}$/:"Diners"==type?cardpatterns.Diners=/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/:"American Express"==type&&(cardpatterns["American Express"]=/^3[47][0-9]{13}$/)}),CLIENT.Checkout.AddressPayment.getCreditCardType(cardpatterns,num)},submitHandler:function(form){var hasPOBox=CLIENT.Checkout.AddressPayment.checkShippingStreetChange(),hasMilAddr=CLIENT.Checkout.AddressPayment.checkShippingCityChange(),ccnum=$.trim($("#ccnumber").val().replace(/ /g,"")),cansubmit=!0;if(hasPOBox||hasMilAddr){var firstError=$("label.error:visible:first");return 0!=firstError.length&&CLIENT.util.scrollToObject(firstError),cansubmit=!1,!1}var hasGiftCard=!1,giftcards=$(":input[name='gift_card_number']:visible");0!=giftcards.length&&giftcards.each(function(){0!=$.trim($(this).val()).length&&(hasGiftCard=!0)});var repairOrderCanSubmit=$("input[name='zo_repairOrderCanSubmit']")?!0:!1;if("COD"!=$("input[name='PAYMENT_TYPE']:checked").val()&&"ADDRESS_PAYMENT"==$("#addressPaymentForm input[name='OPTION']").val()&&!hasGiftCard&&!repairOrderCanSubmit&&-1==ccnum.indexOf("xxxx")&&!CLIENT.Checkout.AddressPayment.validateCreditCard($("#ccnumber"))){var firstError=$("label.error:visible:first");return 0!=firstError.length&&CLIENT.util.scrollToObject(firstError),cansubmit=!1,!1}cansubmit&&(CLIENT.util.hideButton("submitPaymentForm"),form.submit())},validateShippingMethod:function(){$.Log.debug("CLIENT.Checkout.AddressPayment.validateShippingMethod");var country=$("#shippingCountry").val();"JP"==country&&CLIENT.Checkout.AddressPayment.selectJapanShippingMethod()},zipCodeLookup:function(e){$.Log.debug("CLIENT.Checkout.AddressPayment.zipCodeLookup");var o=$(this),val=o.val(),results=null;if("en_US"==CLIENT.Settings.locale.code){var key=e.which||e.keyCode;if("undefined"==typeof key||key>=48&&57>=key||key>=96&&105>=key){var val2=CLIENT.Base.digitOnly(val);if($(this).val(val2),$(this).val().length<5)return!1}}else if("en_CA"==CLIENT.Settings.locale.code&&val.length<6)return!1;if("undefined"!=typeof val&&5==val.length){var cacheValue=CLIENT.Cache.zipCodeLookup[val];"undefined"!=typeof cacheValue&&(results=cacheValue),null==results?CLIENT.Cache.lastZipCode==val?$.Log.debug("zipcode Looks the same to me, no action required"):(CLIENT.Cache.lastZipCode=val,$.Log.debug("Looking Up Results for: "+val,null,"DEBUG"),CLIENT.Checkout.AddressPayment.zipCodeAjaxCall(val,o)):($.Log.debug(val+" found in cache."),CLIENT.Checkout.AddressPayment.zipCodeUiUpdate(results,o))}},zipCodeAjaxCall:function(zip,o){$.Log.debug("CLIENT.Checkout.AddressPayment.zipCodeAjaxCall"),$.ajax({url:CLIENT.Settings.getHost()+"/postalcode-search/",type:"POST",dataType:"json",data:{postalCode:zip},complete:function(response){if(200==response.status||"success"==response.statusText){var data=$.parseJSON(response.responseText);CLIENT.Cache.zipCodeLookup[zip]=data,CLIENT.Checkout.AddressPayment.zipCodeUiUpdate(data,o)}else $.Log.debug("An Error Occurred on the call: "+response.statusText,null,"DEBUG")}})},zipCodeUiUpdate:function(data,o){if($.Log.debug("CLIENT.Checkout.AddressPayment.zipCodeUiUpdate"),"object"!=typeof data)return $.Log.debug("data sent in is not an object"),!1;var inputName=o.attr("name"),city=data.city,state=data.state,country=data.country,errors={};if(errors[inputName]=CLIENT.Settings.alerts.checkout.zipCodeNotValid,"undefined"==typeof city||"undefined"==typeof state||"undefined"==typeof country)return $.Log.debug("missing city, state or country from data object"),o.addClass("invalidPostalCode"),void CLIENT.Checkout.AddressPayment.throwValidatorError(errors);var canUpdate=!1,selectName=o.attr("id").replace("PostalCode","CountrySelect"),hiddenName=o.attr("id").replace("PostalCode","Country"),countrySelect=$("#"+selectName),hiddenCountry=$("#"+hiddenName);if(0==countrySelect.length)$.Log.debug("No CountrySelect found.. comparing to hidden _country_code input value"),hiddenCountry.val()==country?canUpdate=!0:$.Log.debug("Countries do not match: current: "+hiddenCountry.val()+" requested: "+country,null,"DEBUG");else{$.Log.debug("CountrySelect found.. checking to see if this country is an option in the select");var option=countrySelect.find("option[value='"+country+"']");0!=option.length&&(canUpdate=!0)}if(canUpdate){$.Log.debug("Country codes matched...Updating UI"),o.removeClass("invalidPostalCode");var cityName=o.attr("id").replace("PostalCode","City"),stateName=o.attr("id").replace("PostalCode","State");$("#"+cityName).val(city).trigger("keyup"),$("#"+stateName).val(state).trigger("keyup"),hiddenCountry.val(country),0!=countrySelect.length&&countrySelect.val(country),CLIENT.Checkout.AddressPayment.updateAddressUI(o)}else o.addClass("invalidPostalCode"),CLIENT.Checkout.AddressPayment.throwValidatorError(errors)},setFormElementValid:function(o){$.Log.debug("Setting form element valid"),o.removeClass("invalid").addClass("valid"),o.parents(".form-group").removeClass("has-error").addClass("has-success"),o.siblings(".error-message").length>0&&o.siblings(".error-message").remove()},updateAddressUI:function(o){var type=o.attr("id").replace("PostalCode",""),city=$("#"+type+"CityWrapper"),state=$("#"+type+"StateSelectWrapper"),notice=$("#"+type+"PostalCodeNoticeWrapper"),country=$("#"+type+"CountryWrapper"),postal=$("#"+type+"PostalCodeWrapper");city.removeClass("hide"),state.removeClass("hide"),notice.addClass("hide"),country.removeClass("hide"),postal.removeClass("half").addClass("quarter")},throwValidatorError:function(errors){$.Log.debug("CLIENT.Checkout.AddressPayment.throwValidatorError"),null!=errors&&"object"==typeof errors&&$.each(errors,function(formElementName,errorMessage){var $formControl=$("[name="+formElementName+"]");"zop_cc_exp_date-1"==formElementName&&($formControl=$("#ccexpyear"));
var $formGroup=$formControl.parents(".form-group"),labelFor=$formControl.attr("id");$.Log.debug("Invalid form element: "+labelFor),$formGroup.hasClass("has-error")||($formControl.removeClass("valid").addClass("invalid"),$formControl.parent().removeClass("has-success").addClass("has-error"),$formControl.parent().append("<label class='error-message static' for='"+labelFor+"'>"+errorMessage+"</label>"))})}},Confirm:{paypal:!1,init:function(){CLIENT.Checkout.Confirm.bindToggleTermsCondsCheck(),$("#confirmOrderForm").submit(function(){$.Log.debug("In the submit handler for confirmOrderForm"),CLIENT.util.hideButton("completeButton");var rtn=!0;return CLIENT.Checkout.Confirm.paypal?($.Log.debug("In Paypal, returning: "+rtn),rtn=CLIENT.Checkout.Confirm.payPalSubmit()):($.Log.debug("In regular, returning: "+rtn),rtn=CLIENT.Checkout.Confirm.standardSubmit()),rtn||CLIENT.util.enableButton("completeButton"),rtn})},bindToggleTermsCondsCheck:function(){$("#confirmTCcheckbox").on("change",function(){$.Log.debug("confirmTCcheckbox click"),CLIENT.Checkout.Confirm.toggleTermsCondsCheck()})},toggleTermsCondsCheck:function(){$.Log.debug("CLIENT.Checkout.Confirm.toggleTermsCondsCheck");var form=$("#confirmOrderForm"),errorDisplay=$("#confirmButtonError");"disabled"==form.attr("disabled")?form.removeAttr("disabled"):form.attr("disabled","disabled"),errorDisplay.is(":visible")&&errorDisplay.addClass("hide")},payPalSubmit:function(){var canContinue=!0,error="";return $("#shippingAddress1").length&&((CLIENT.Checkout.Confirm.hasPostOfficeBox($("#shippingAddress1").val())||CLIENT.Checkout.Confirm.hasPostOfficeBox($("#shippingAddress2").val()))&&(canContinue=!1,error=CLIENT.Settings.alerts.checkout.payPalPOBoxError),CLIENT.Checkout.Confirm.hasMilitaryAddress($("#shippingCity").val(),$("#shippingPostalCode").val())&&(error=CLIENT.Settings.alerts.checkout.payPalMilitaryAddressError,canContinue=!1),error.length?$("#shippingError","#shippingWrapper").length||($("#shippingWrapper").append("<span class='checkout-label normal' id='shippingError'><p class='error'>"+error+"</p></span>"),CLIENT.util.scrollToObject($("#billingWrapper"),65)):$("#shippingError").remove()),canContinue},standardSubmit:function(){$.Log.debug("CLIENT.Checkout.Confirm.standardSubmit");var canContinue=!0,error="";return $("#shippingAddress1").length&&((CLIENT.Checkout.Confirm.hasPostOfficeBox($("#shippingAddress1").val())||CLIENT.Checkout.Confirm.hasPostOfficeBox($("#shippingAddress2").val()))&&(canContinue=!1,error=CLIENT.Settings.alerts.checkout.payPalPOBoxError),CLIENT.Checkout.Confirm.hasMilitaryAddress($("#shippingCity").val(),$("#shippingPostalCode").val())&&(error=CLIENT.Settings.alerts.checkout.payPalMilitaryAddressError,canContinue=!1),error.length?$("#shippingError","#shippingWrapper").length||($("#shippingWrapper").append("<span class='checkout-label normal' id='shippingError'><p class='error'>"+error+"</p></span>"),CLIENT.util.scrollToObject($("#billingWrapper"),65)):$("#shippingError").remove()),canContinue},testReadyForSubmit:function(elementForTesting){var source=$(elementForTesting),form=$("#confirmOrderForm"),errorDisplay=$("#confirmButtonError");return source.is("button")?form.is("[disabled]")?(errorDisplay.removeClass("hide"),$("#clickToSubmit").focus(),!1):!0:source.is(":checked")?(form.removeAttr("disabled"),errorDisplay.addClass("hide"),!0):(form.attr("disabled","disabled"),!1)},hasPostOfficeBox:function(a){var tmp=a.replace(/[^\w]/gi,"");return tmp.search(/pobox/i)>-1||tmp.search(/^po\d/i)>-1||tmp.search(/^pob\d/i)>-1||tmp.search(/postoffice/i)>-1?!0:!1},hasMilitaryAddress:function(c,z){var noCheck="fr_FR,it_IT,es_ES,de_DE,en_UK";if(0!=CLIENT.Settings.locale.code.length&&-1!=noCheck.indexOf(CLIENT.Settings.locale.code))return!1;var tmp=c.replace(/[^A-Za-z0-9]/g,"");if(tmp.search(/^[ADF]PO$/i)>-1)return!0;if(c.search(/\s*[ADF]PO\s+/i)>-1)return!0;var pc=z.replace(/[^0-9]/g,"");return pc.search(/^09|^340|^96[2-6]/)>-1?!0:!1}},Complete:{init:function(){$("#btnviewdetails").click(function(){return $(this).slideFade(),$("#completeorderdetails").slideFade(),!1}),CLIENT.iosSlider.loadVisibleCarousels(),CLIENT.iosSlider.bindLazyCarouselLoad()}},Order:{userCCNum:null,cleanCCNum:null}},jQuery(document).ready(function(){}),jQuery(window).load(function(){_FirstRowBorder()}),jQuery('.nix-checkout-container a[href="#"]').click(function(e){e.preventDefault()}),jQuery(window).resize(function(){_FirstRowBorder()}),jQuery(".nix-checkout-container .coupon").on("keyup",function(){var value=jQuery(this).val();return value.length?void("bck2skool"==value.toLowerCase()?(jQuery(this).siblings(".valid").css("opacity","1"),jQuery(this).siblings(".invalid").css("opacity","0"),jQuery(".nix-checkout-container .coupon-total").html("-$15.00")):(jQuery(this).siblings(".valid").css("opacity","0"),jQuery(this).siblings(".invalid").css("opacity","1"),jQuery(".nix-checkout-container .coupon-total").html("$0.00"))):void jQuery(this).siblings(".invalid, .valid").css("opacity","0")}),jQuery(".nix-checkout-container .invalid").click(function(){"0"!=jQuery(this).css("opacity")&&(jQuery(this).siblings(".coupon").val(""),jQuery(this).css("opacity","0"),jQuery(".nix-checkout-container .coupon-total").html("$0.00"))}),jQuery(".nix-checkout-container .coupon-link").click(function(){jQuery(".nix-checkout-container .coupon-step1").hide(),jQuery(".nix-checkout-container .coupon-step2").show()}),jQuery(".nix-checkout-container .payment-buttons .option-button").click(function(e){e.preventDefault();var target=jQuery(this).attr("data-tab");if("undefined"!=typeof target){if(jQuery(this).hasClass("clicked"))return jQuery(".nix-checkout-container .payment-tabs").children('[data-tab="'+target+'"]').hide(),void jQuery(this).removeClass("clicked");jQuery(".nix-checkout-container .payment-tabs").children().hide(),jQuery(".nix-checkout-container .payment-tabs").children('[data-tab="'+target+'"]').toggle(),jQuery(".nix-checkout-container .payment-buttons .option-button").removeClass("clicked"),jQuery(this).toggleClass("clicked")}}),jQuery("html").click(function(){jQuery(".nix-checkout-container .nix-select .options").hide()}),jQuery(".nix-checkout-container").on("click",".nix-select",function(e){e.stopPropagation(),jQuery(this).find(".options").toggle()}),jQuery(".nix-checkout-container").on("click",".nix-select .list-item",function(e){e.stopPropagation();var v=jQuery(this).attr("value"),h=jQuery(this).html(),f=jQuery(this).attr("for");jQuery(this).closest(".options").hide(),jQuery(this).closest(".nix-select").find(".placeholder").html(h),jQuery(this).closest(".nix-select").siblings("."+f).val(v)}),jQuery(".nix-checkout-container").on("click",".nix-gift-card-selector .list-item",function(){var v=jQuery(this).attr("value"),c=jQuery(".nix-checkout-container .nix-gift-card-items").children().length;if(v>c)for(i=1;i<=v-c;i++)jQuery(".nix-checkout-container .nix-gift-card-items").append('<input class="nix-input col-lg-12 col-sm-12 col-xs-12" type="text" placeholder="Gift Card Number">');else for(i=v;i<c;i++)jQuery(".nix-checkout-container .nix-gift-card-items").children().last().remove()}),_HideMenusInConfirmationMobile(),jQuery(window).resize(function(){_HideMenusInConfirmationMobile()}),function(){{var $,cardFromNumber,cards,defaultFormat,formatBackCardNumber,formatCardNumber,hasTextSelected,reFormatCardNumber,restrictCardNumber,restrictNumeric,setCardType,__slice=[].slice;[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1}}$=jQuery,$.formatcc={},$.formatcc.fn={},$.fn.formatcc=function(){var args,method;return method=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],$.formatcc.fn[method].apply(this,args)},$.formatcc.fn.format_credit_card_number=function(){return this.formatcc("restrictNumeric"),this.on("keypress",restrictCardNumber),this.on("keypress",formatCardNumber),this.on("keydown",formatBackCardNumber),this.on("keyup",setCardType),this},hasTextSelected=function($target){var _ref;return null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==$target.prop("selectionEnd")?!0:("undefined"!=typeof document&&null!==document&&null!=(_ref=document.selection)&&"function"==typeof _ref.createRange?_ref.createRange().text:void 0)?!0:!1},restrictCardNumber=function(e){var $target,card,digit,value;return $target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target)?(value=($target.val()+digit).replace(/\D/g,""),card=cardFromNumber(value),card?value.length<=card.length[card.length.length-1]:value.length<=16):void 0},restrictNumeric=function(e){var $target,input;return $target=$(e.target),e.metaKey||e.ctrlKey?!0:32===e.which?!1:0===e.which?!0:e.which<33?!0:(input=String.fromCharCode(e.which),!!/[\d\s]/.test(input))},$.formatcc.fn.restrictNumeric=function(){return this.on("keypress",restrictNumeric),this},defaultFormat=/(\d{1,4})/g,cards=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:defaultFormat,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:defaultFormat,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:defaultFormat,length:[13,14,15,16],cvcLength:[3],luhn:!0}],formatCardNumber=function(e){var $target,card,digit,length,re,upperLength,value;return digit=String.fromCharCode(e.which),!/^\d+$/.test(digit)||($target=$(e.currentTarget),value=$target.val(),card=cardFromNumber(value+digit),length=(value.replace(/\D/g,"")+digit).length,upperLength=16,card&&(upperLength=card.length[card.length.length-1]),length>=upperLength||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length)?void 0:(re=card&&"amex"===card.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,re.test(value)?(e.preventDefault(),$target.val(value+" "+digit)):re.test(value+digit)?(e.preventDefault(),$target.val(value+digit+" ")):void 0)},cardFromNumber=function(num){var card,_i,_len;for(num=(num+"").replace(/\D/g,""),_i=0,_len=cards.length;_len>_i;_i++)if(card=cards[_i],card.pattern.test(num))return card},reFormatCardNumber=function(e){return setTimeout(function(){var $target,value;return $target=$(e.currentTarget),value=$target.val(),value=$.formatcc.formatCardNumber(value),$target.val(value)})},formatBackCardNumber=function(e){var $target,value;return $target=$(e.currentTarget),value=$target.val(),e.meta||8!==e.which||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length?void 0:/\d\s$/.test(value)?(e.preventDefault(),$target.val(value.replace(/\d\s$/,""))):/\s\d?$/.test(value)?(e.preventDefault(),$target.val(value.replace(/\s\d?$/,""))):void 0},setCardType=function(e){var $target,allTypes,card,cardType,val;return $target=$(e.currentTarget),val=$target.val(),cardType=$.formatcc.creditCardType(val)||"unknown",$target.hasClass(cardType)?void 0:(allTypes=function(){var _i,_len,_results;for(_results=[],_i=0,_len=cards.length;_len>_i;_i++)card=cards[_i],_results.push(card.type);return _results}(),$target.removeClass("unknown"),$target.removeClass(allTypes.join(" ")),$target.addClass(cardType),$target.toggleClass("identified","unknown"!==cardType),$target.trigger("payment.cardType",cardType))},$.formatcc.creditCardType=function(num){var _ref;return num?(null!=(_ref=cardFromNumber(num))?_ref.type:void 0)||null:null}}.call(this),function(u,q,e){var l=e(u),r=e(q),a=e.fancybox=function(){a.open.apply(this,arguments)},s=!1,t=null;e.extend(a,{version:"2.0.4",defaults:{padding:15,margin:20,width:800,height:600,minWidth:200,minHeight:200,maxWidth:9999,maxHeight:9999,autoSize:!0,fitToView:!0,aspectRatio:!1,topRatio:.5,fixed:!0,scrolling:"auto",wrapCSS:"fancybox-default",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,modal:!1,loop:!0,ajax:{},keys:{next:[13,32,34,39,40],prev:[8,33,37,38],close:[27]},tpl:{wrap:'<div class="fancybox-wrap"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe class="fancybox-iframe" name="fancybox-frame{rnd}" frameborder="0" hspace="0" allowtransparency="true" scrolling="{scrolling}" src="{href}"></iframe>',swf:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<div title="Close" class="fancybox-item fancybox-close">Close</div>',next:'<a title="Next" class="fancybox-item fancybox-next"><span>Next</span></a>',prev:'<a title="Previous" class="fancybox-item fancybox-prev"><span>Previous</span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:300,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:300,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:{speedIn:0,speedOut:300,opacity:.8,css:{cursor:"pointer"},closeClick:!0},title:{type:"float"}}},group:{},opts:{},coming:null,current:null,isOpen:!1,isOpened:!1,wrap:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(b,c){e.isArray(b)||(b=[b]),b.length&&(a.close(!0),a.opts=e.extend(!0,{},a.defaults,c),a.group=b,a._start(a.opts.index||0))},cancel:function(){a.coming&&!1===a.trigger("onCancel")||(a.coming=null,a.hideLoading(),a.ajaxLoad&&a.ajaxLoad.abort(),a.ajaxLoad=null,!a.imgPreload)||(a.imgPreload.onload=a.imgPreload.onabort=a.imgPreload.onerror=null)},close:function(b){a.cancel(),a.current&&!1!==a.trigger("beforeClose")&&(a.unbindEvents(),!a.isOpen||b&&!0===b[0]?(e(".fancybox-wrap").stop().trigger("onReset").remove(),a._afterZoomOut()):(a.isOpen=a.isOpened=!1,e(".fancybox-item").remove(),a.wrap.stop(!0).removeClass("fancybox-opened"),a.inner.css("overflow","hidden"),a.transitions[a.current.closeMethod]()))},play:function(b){var c=function(){clearTimeout(a.player.timer)},d=function(){c(),a.current&&a.player.isActive&&(a.player.timer=setTimeout(a.next,a.current.playSpeed))},g=function(){c(),e("body").unbind(".player"),a.player.isActive=!1,a.trigger("onPlayEnd")};a.player.isActive||b&&!1===b[0]?g():a.current&&(a.current.loop||a.current.index<a.group.length-1)&&(a.player.isActive=!0,e("body").bind({"afterShow.player onUpdate.player":d,"onCancel.player beforeClose.player":g,"beforeLoad.player":c}),d(),a.trigger("onPlayStart"))},next:function(){a.current&&a.jumpto(a.current.index+1)},prev:function(){a.current&&a.jumpto(a.current.index-1)},jumpto:function(b){a.current&&(b=parseInt(b,10),1<a.group.length&&a.current.loop&&(b>=a.group.length?b=0:0>b&&(b=a.group.length-1)),"undefined"!=typeof a.group[b]&&(a.cancel(),a._start(b)))},reposition:function(b){a.isOpen&&a.wrap.css(a._getPosition(b))},update:function(){a.isOpen&&(s||(t=setInterval(function(){s&&(s=!1,clearTimeout(t),a.current)&&(a.current.autoSize&&(a.inner.height("auto"),a.current.height=a.inner.height()),a._setDimension(),a.current.canGrow&&a.inner.height("auto"),a.reposition(),a.trigger("onUpdate"))},100)),s=!0)},toggle:function(){a.isOpen&&(a.current.fitToView=!a.current.fitToView,a.update())},hideLoading:function(){e("#fancybox-loading").remove()},showLoading:function(){a.hideLoading(),e('<div id="fancybox-loading"></div>').click(a.cancel).appendTo("body")},getViewport:function(){return{x:l.scrollLeft(),y:l.scrollTop(),w:l.width(),h:l.height()}},unbindEvents:function(){a.wrap&&a.wrap.unbind(".fb"),r.unbind(".fb"),l.unbind(".fb")},bindEvents:function(){var b=a.current,c=b.keys;b&&(l.bind("resize.fb, orientationchange.fb",a.update),c&&r.bind("keydown.fb",function(b){var g;b.ctrlKey||b.altKey||b.shiftKey||b.metaKey||!(0>e.inArray(b.target.tagName.toLowerCase(),["input","textarea","select","button"]))||(g=b.keyCode,-1<e.inArray(g,c.close)?(a.close(),b.preventDefault()):-1<e.inArray(g,c.next)?(a.next(),b.preventDefault()):-1<e.inArray(g,c.prev)&&(a.prev(),b.preventDefault()))}),e.fn.mousewheel&&b.mouseWheel&&1<a.group.length&&a.wrap.bind("mousewheel.fb",function(b,c){var f=e(b.target).get(0);(0===f.clientHeight||f.scrollHeight===f.clientHeight)&&(b.preventDefault(),a[c>0?"prev":"next"]())}))},trigger:function(b){var c,d=a[-1<e.inArray(b,["onCancel","beforeLoad","afterLoad"])?"coming":"current"];if(d){if(e.isFunction(d[b])&&(c=d[b].apply(d,Array.prototype.slice.call(arguments,1))),!1===c)return!1;d.helpers&&e.each(d.helpers,function(c,f){f&&"undefined"!=typeof a.helpers[c]&&e.isFunction(a.helpers[c][b])&&a.helpers[c][b](f,d)}),e.event.trigger(b+".fb")}},isImage:function(a){return a&&a.match(/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i)},isSWF:function(a){return a&&a.match(/\.(swf)(.*)?$/i)},_start:function(b){var g,f,k,c={},d=a.group[b]||null;"object"==typeof d&&(d.nodeType||d instanceof e)&&(g=!0,e.metadata&&(c=e(d).metadata())),c=e.extend(!0,{},a.opts,{index:b,element:d},e.isPlainObject(d)?d:c),e.each(["href","title","content","type"],function(b,f){c[f]=a.opts[f]||g&&e(d).attr(f)||c[f]||null}),"number"==typeof c.margin&&(c.margin=[c.margin,c.margin,c.margin,c.margin]),c.modal&&e.extend(!0,c,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{css:{cursor:"auto"},closeClick:!1}}}),a.coming=c,!1===a.trigger("beforeLoad")?a.coming=null:(f=c.type,b=c.href,f||(g&&(k=e(d).data("fancybox-type"),!k&&d.className&&(f=(k=d.className.match(/fancybox\.(\w+)/))?k[1]:null)),!f&&b&&(a.isImage(b)?f="image":a.isSWF(b)?f="swf":b.match(/^#/)&&(f="inline")),f||(f=g?"inline":"html"),c.type=f),"inline"===f||"html"===f?(c.content=c.content||("inline"===f&&b?e(b):d),c.content.length||(f=null)):(c.href=b||d,c.href||(f=null)),c.group=a.group,"image"===f?a._loadImage():"ajax"===f?a._loadAjax():f?a._afterLoad():a._error("type"))},_error:function(b){e.extend(a.coming,{type:"html",autoSize:!0,minHeight:"0",hasError:b,content:a.coming.tpl.error}),a._afterLoad()},_loadImage:function(){a.imgPreload=new Image,a.imgPreload.onload=function(){this.onload=this.onerror=null,a.coming.width=this.width,a.coming.height=this.height,a._afterLoad()},a.imgPreload.onerror=function(){this.onload=this.onerror=null,a._error("image")},a.imgPreload.src=a.coming.href,a.imgPreload.complete||a.showLoading()},_loadAjax:function(){a.showLoading(),a.ajaxLoad=e.ajax(e.extend({},a.coming.ajax,{url:a.coming.href,error:function(b,c){"abort"!==c?a._error("ajax",b):a.hideLoading()},success:function(b,c){"success"===c&&(a.coming.content=b,a._afterLoad())}}))},_preload:function(){var b=a.group,c=a.current.index,d=function(b){b&&a.isImage(b)&&((new Image).src=b)};1<b.length&&(d(e(b[c+1]||b[0]).attr("href")),d(e(b[c-1]||b[b.length-1]).attr("href")))},_afterLoad:function(){a.hideLoading(),a.coming&&!1!==a.trigger("afterLoad",a.current)?(a.isOpened?(e(".fancybox-item").remove(),a.wrap.stop(!0).removeClass("fancybox-opened"),a.inner.css("overflow","hidden"),a.transitions[a.current.prevMethod]()):(e(".fancybox-wrap").stop().trigger("onReset").remove(),a.trigger("afterClose")),a.unbindEvents(),a.isOpen=!1,a.current=a.coming,a.coming=!1,a.wrap=e(a.current.tpl.wrap).addClass("fancybox-tmp "+a.current.wrapCSS).appendTo("body"),a.outer=e(".fancybox-outer",a.wrap).css("padding",a.current.padding+"px"),a.inner=e(".fancybox-inner",a.wrap),a._setContent(),a.trigger("beforeShow"),a._setDimension(),a.wrap.hide().removeClass("fancybox-tmp"),a.bindEvents(),a._preload(),a.transitions[a.isOpened?a.current.nextMethod:a.current.openMethod]()):a.coming=!1},_setContent:function(){var b,c,d=a.current,g=d.type;switch(g){case"inline":case"ajax":case"html":b=d.content,"inline"===g&&b instanceof e&&(b=b.show().detach(),b.parent().hasClass("fancybox-inner")&&b.parents(".fancybox-wrap").trigger("onReset").remove(),e(a.wrap).bind("onReset",function(){b.appendTo("body").hide()})),d.autoSize&&(c=e('<div class="fancybox-tmp"></div>').appendTo(e("body")).append(b),d.width=c.outerWidth(),d.height=c.outerHeight(!0),b=c.contents().detach(),c.remove());break;case"image":b=d.tpl.image.replace("{href}",d.href),d.aspectRatio=!0;break;case"swf":b=d.tpl.swf.replace(/\{width\}/g,d.width).replace(/\{height\}/g,d.height).replace(/\{href\}/g,d.href);break;case"iframe":b=d.tpl.iframe.replace("{href}",d.href).replace("{scrolling}",d.scrolling).replace("{rnd}",(new Date).getTime())}-1<e.inArray(g,["image","swf","iframe"])&&(d.autoSize=!1,d.scrolling=!1),a.inner.append(b)},_setDimension:function(){var b=a.wrap,c=a.outer,d=a.inner,g=a.current,f=a.getViewport(),k=g.margin,i=2*g.padding,h=g.width+i,j=g.height+i,l=g.width/g.height,o=g.maxWidth,m=g.maxHeight,n=g.minWidth,p=g.minHeight;if(f.w-=k[1]+k[3],f.h-=k[0]+k[2],-1<h.toString().indexOf("%")&&(h=f.w*parseFloat(h)/100),-1<j.toString().indexOf("%")&&(j=f.h*parseFloat(j)/100),g.fitToView&&(o=Math.min(f.w,o),m=Math.min(f.h,m)),n=Math.min(h,n),p=Math.min(h,p),o=Math.max(n,o),m=Math.max(p,m),g.aspectRatio?(h>o&&(h=o,j=(h-i)/l+i),j>m&&(j=m,h=(j-i)*l+i),n>h&&(h=n,j=(h-i)/l+i),p>j&&(j=p,h=(j-i)*l+i)):(h=Math.max(n,Math.min(h,o)),j=Math.max(p,Math.min(j,m))),h=Math.round(h),j=Math.round(j),e(b.add(c).add(d)).width("auto").height("auto"),d.width(h-i).height(j-i),b.width(h),k=b.height(),h>o||k>m)for(;(h>o||k>m)&&h>n&&k>p;)j-=10,g.aspectRatio?(h=Math.round((j-i)*l+i),n>h&&(h=n,j=(h-i)/l+i)):h-=10,d.width(h-i).height(j-i),b.width(h),k=b.height();g.dim={width:h,height:k},g.canGrow=g.autoSize&&j>p&&m>j,g.canShrink=!1,g.canExpand=!1,h-i<g.width||j-i<g.height?g.canExpand=!0:(h>f.w||k>f.h)&&h>n&&j>p&&(g.canShrink=!0),b=k-i,a.innerSpace=b-d.height(),a.outerSpace=b-c.height()},_getPosition:function(b){var c=a.current,d=a.getViewport(),e=c.margin,f=a.wrap.width()+e[1]+e[3],k=a.wrap.height()+e[0]+e[2],i={position:"absolute",top:e[0]+d.y,left:e[3]+d.x};return c.fixed&&(!b||!1===b[0])&&k<=d.h&&f<=d.w&&(i={position:"fixed",top:e[0],left:e[3]}),i.top=Math.ceil(Math.max(i.top,i.top+(d.h-k)*c.topRatio))+"px",i.left=Math.ceil(Math.max(i.left,i.left+.5*(d.w-f)))+"px",i},_afterZoomIn:function(){var b=a.current;a.isOpen=a.isOpened=!0,a.wrap.addClass("fancybox-opened").css("overflow","visible"),a.update(),a.inner.css("overflow","auto"===b.scrolling?"auto":"yes"===b.scrolling?"scroll":"hidden"),(b.closeClick||b.nextClick)&&a.inner.css("cursor","pointer").bind("click.fb",b.nextClick?a.next:a.close),b.closeBtn&&e(b.tpl.closeBtn).appendTo(a.wrap).bind("click.fb",a.close),b.arrows&&1<a.group.length&&((b.loop||0<b.index)&&e(b.tpl.prev).appendTo(a.wrap).bind("click.fb",a.prev),(b.loop||b.index<a.group.length-1)&&e(b.tpl.next).appendTo(a.wrap).bind("click.fb",a.next)),a.trigger("afterShow"),a.opts.autoPlay&&!a.player.isActive&&(a.opts.autoPlay=!1,a.play())},_afterZoomOut:function(){a.trigger("afterClose"),a.wrap.trigger("onReset").remove(),e.extend(a,{group:{},opts:{},current:null,isOpened:!1,isOpen:!1,wrap:null,outer:null,inner:null})}}),a.transitions={getOrigPosition:function(){var f,b=a.current.element,c={},d=50,g=50;return b&&b.nodeName&&e(b).is(":visible")?(f=e(b).find("img:first"),f.length?(c=f.offset(),d=f.outerWidth(),g=f.outerHeight()):c=e(b).offset()):(b=a.getViewport(),c.top=b.y+.5*(b.h-g),c.left=b.x+.5*(b.w-d)),c={top:Math.ceil(c.top)+"px",left:Math.ceil(c.left)+"px",width:Math.ceil(d)+"px",height:Math.ceil(g)+"px"}},step:function(b,c){var d,e,f;("width"===c.prop||"height"===c.prop)&&(e=f=Math.ceil(b-2*a.current.padding),"height"===c.prop&&(d=(b-c.start)/(c.end-c.start),c.start>c.end&&(d=1-d),e-=a.innerSpace*d,f-=a.outerSpace*d),a.inner[c.prop](e),a.outer[c.prop](f))},zoomIn:function(){var d,g,b=a.wrap,c=a.current;d=c.dim,"elastic"===c.openEffect?(g=e.extend({},d,a._getPosition(!0)),delete g.position,d=this.getOrigPosition(),c.openOpacity&&(d.opacity=0,g.opacity=1),b.css(d).show().animate(g,{duration:c.openSpeed,easing:c.openEasing,step:this.step,complete:a._afterZoomIn})):(b.css(e.extend({},d,a._getPosition())),"fade"===c.openEffect?b.fadeIn(c.openSpeed,a._afterZoomIn):(b.show(),a._afterZoomIn()))},zoomOut:function(){var d,b=a.wrap,c=a.current;"elastic"===c.closeEffect?("fixed"===b.css("position")&&b.css(a._getPosition(!0)),d=this.getOrigPosition(),c.closeOpacity&&(d.opacity=0),b.animate(d,{duration:c.closeSpeed,easing:c.closeEasing,step:this.step,complete:a._afterZoomOut})):b.fadeOut("fade"===c.closeEffect?c.closeSpeed:0,a._afterZoomOut)},changeIn:function(){var d,b=a.wrap,c=a.current;"elastic"===c.nextEffect?(d=a._getPosition(!0),d.opacity=0,d.top=parseInt(d.top,10)-200+"px",b.css(d).show().animate({opacity:1,top:"+=200px"},{duration:c.nextSpeed,complete:a._afterZoomIn})):(b.css(a._getPosition()),"fade"===c.nextEffect?b.hide().fadeIn(c.nextSpeed,a._afterZoomIn):(b.show(),a._afterZoomIn()))},changeOut:function(){var b=a.wrap,c=a.current,d=function(){e(this).trigger("onReset").remove()};b.removeClass("fancybox-opened"),"elastic"===c.prevEffect?b.animate({opacity:0,top:"+=200px"},{duration:c.prevSpeed,complete:d}):b.fadeOut("fade"===c.prevEffect?c.prevSpeed:0,d)}},a.helpers.overlay={overlay:null,update:function(){var a;this.overlay.width(0).height(0),a=r.width(),this.overlay.width(a).height(r.height())},beforeShow:function(b){this.overlay||(this.overlay=e('<div id="fancybox-overlay"></div>').css(b.css||{background:"black"}).appendTo("body"),this.update(),b.closeClick&&this.overlay.bind("click.fb",a.close),l.bind("resize.fb",e.proxy(this.update,this)),this.overlay.fadeTo(b.speedIn||"fast",b.opacity||1))},onUpdate:function(){this.update()},afterClose:function(a){this.overlay&&this.overlay.fadeOut(a.speedOut||"fast",function(){e(this).remove()}),this.overlay=null}},a.helpers.title={beforeShow:function(b){var c;(c=a.current.title)&&(c=e('<div class="fancybox-title fancybox-title-'+b.type+'-wrap">'+c+"</div>").appendTo("body"),"float"===b.type&&(c.width(c.width()),c.wrapInner('<span class="child"></span>'),a.current.margin[2]+=Math.abs(parseInt(c.css("margin-bottom"),10))),c.appendTo("over"===b.type?a.inner:"outside"===b.type?a.wrap:a.outer))}},e.fn.fancybox=function(b){function c(b){var i,c=[],h=this.rel;b.ctrlKey||b.altKey||b.shiftKey||b.metaKey||(b.preventDefault(),b=e(this).data("fancybox-group"),"undefined"!=typeof b?i=b?"data-fancybox-group":!1:h&&""!==h&&"nofollow"!==h&&(b=h,i="rel"),i&&(c=g.length?e(g).filter("["+i+'="'+b+'"]'):e("["+i+'="'+b+'"]')),c.length?(d.index=c.index(this),a.open(c.get(),d)):(d.index=0,a.open(this,d)))}var d=b||{},g=this.selector||"";return g?r.undelegate(g,"click.fb-start").delegate(g,"click.fb-start",c):e(this).unbind("click.fb-start").bind("click.fb-start",c),this}}(window,document,jQuery),$.fancybox.defaults.padding=0,$.fancybox.defaults.prevEffect="fade",$.fancybox.defaults.nextEffect="fade",$.fancybox.defaults.margin=[40,50,60,50],$.fancybox.defaults.helpers.overlay.opacity=.9,$.fancybox.defaults.helpers.overlay.css={"background-color":"#fff"},eval(function(p,a,c,k,e,r){if(e=function(c){return(a>c?"":e(parseInt(c/a)))+((c%=a)>35?String.fromCharCode(c+29):c.toString(36))},!"".replace(/^/,String)){for(;c--;)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}],e=function(){return"\\w+"},c=1}for(;c--;)k[c]&&(p=p.replace(new RegExp("\\b"+e(c)+"\\b","g"),k[c]));return p}("h.i['1a']=h.i['z'];h.O(h.i,{y:'D',z:9(x,t,b,c,d){6 h.i[h.i.y](x,t,b,c,d)},17:9(x,t,b,c,d){6 c*(t/=d)*t+b},D:9(x,t,b,c,d){6-c*(t/=d)*(t-2)+b},13:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t+b;6-c/2*((--t)*(t-2)-1)+b},X:9(x,t,b,c,d){6 c*(t/=d)*t*t+b},U:9(x,t,b,c,d){6 c*((t=t/d-1)*t*t+1)+b},R:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t+b;6 c/2*((t-=2)*t*t+2)+b},N:9(x,t,b,c,d){6 c*(t/=d)*t*t*t+b},M:9(x,t,b,c,d){6-c*((t=t/d-1)*t*t*t-1)+b},L:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t*t+b;6-c/2*((t-=2)*t*t*t-2)+b},K:9(x,t,b,c,d){6 c*(t/=d)*t*t*t*t+b},J:9(x,t,b,c,d){6 c*((t=t/d-1)*t*t*t*t+1)+b},I:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t*t*t+b;6 c/2*((t-=2)*t*t*t*t+2)+b},G:9(x,t,b,c,d){6-c*8.C(t/d*(8.g/2))+c+b},15:9(x,t,b,c,d){6 c*8.n(t/d*(8.g/2))+b},12:9(x,t,b,c,d){6-c/2*(8.C(8.g*t/d)-1)+b},Z:9(x,t,b,c,d){6(t==0)?b:c*8.j(2,10*(t/d-1))+b},Y:9(x,t,b,c,d){6(t==d)?b+c:c*(-8.j(2,-10*t/d)+1)+b},W:9(x,t,b,c,d){e(t==0)6 b;e(t==d)6 b+c;e((t/=d/2)<1)6 c/2*8.j(2,10*(t-1))+b;6 c/2*(-8.j(2,-10*--t)+2)+b},V:9(x,t,b,c,d){6-c*(8.o(1-(t/=d)*t)-1)+b},S:9(x,t,b,c,d){6 c*8.o(1-(t=t/d-1)*t)+b},Q:9(x,t,b,c,d){e((t/=d/2)<1)6-c/2*(8.o(1-t*t)-1)+b;6 c/2*(8.o(1-(t-=2)*t)+1)+b},P:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d)==1)6 b+c;e(!p)p=d*.3;e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);6-(a*8.j(2,10*(t-=1))*8.n((t*d-s)*(2*8.g)/p))+b},H:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d)==1)6 b+c;e(!p)p=d*.3;e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);6 a*8.j(2,-10*t)*8.n((t*d-s)*(2*8.g)/p)+c+b},T:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d/2)==2)6 b+c;e(!p)p=d*(.3*1.5);e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);e(t<1)6-.5*(a*8.j(2,10*(t-=1))*8.n((t*d-s)*(2*8.g)/p))+b;6 a*8.j(2,-10*(t-=1))*8.n((t*d-s)*(2*8.g)/p)*.5+c+b},F:9(x,t,b,c,d,s){e(s==u)s=1.l;6 c*(t/=d)*t*((s+1)*t-s)+b},E:9(x,t,b,c,d,s){e(s==u)s=1.l;6 c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},16:9(x,t,b,c,d,s){e(s==u)s=1.l;e((t/=d/2)<1)6 c/2*(t*t*(((s*=(1.B))+1)*t-s))+b;6 c/2*((t-=2)*t*(((s*=(1.B))+1)*t+s)+2)+b},A:9(x,t,b,c,d){6 c-h.i.v(x,d-t,0,c,d)+b},v:9(x,t,b,c,d){e((t/=d)<(1/2.k)){6 c*(7.q*t*t)+b}m e(t<(2/2.k)){6 c*(7.q*(t-=(1.5/2.k))*t+.k)+b}m e(t<(2.5/2.k)){6 c*(7.q*(t-=(2.14/2.k))*t+.11)+b}m{6 c*(7.q*(t-=(2.18/2.k))*t+.19)+b}},1b:9(x,t,b,c,d){e(t<d/2)6 h.i.A(x,t*2,0,c,d)*.5+b;6 h.i.v(x,t*2-d,0,c,d)*.5+c*.5+b}});",62,74,"||||||return||Math|function|||||if|var|PI|jQuery|easing|pow|75|70158|else|sin|sqrt||5625|asin|||undefined|easeOutBounce|abs||def|swing|easeInBounce|525|cos|easeOutQuad|easeOutBack|easeInBack|easeInSine|easeOutElastic|easeInOutQuint|easeOutQuint|easeInQuint|easeInOutQuart|easeOutQuart|easeInQuart|extend|easeInElastic|easeInOutCirc|easeInOutCubic|easeOutCirc|easeInOutElastic|easeOutCubic|easeInCirc|easeInOutExpo|easeInCubic|easeOutExpo|easeInExpo||9375|easeInOutSine|easeInOutQuad|25|easeOutSine|easeInOutBack|easeInQuad|625|984375|jswing|easeInOutBounce".split("|"),0,{})),function($){$.fn.slideFade=function(){for(var i=0;i<arguments.length;i++)if("number"==typeof arguments[i])var slideSpeed=arguments[i];else var callBack=arguments[i];if(!slideSpeed)var slideSpeed=300;this.animate({opacity:"toggle",height:"toggle"},slideSpeed,function(){"function"!=typeof callBack&&(callBack=function(){}),callBack.call(this)})}}(jQuery),function($){$.belowthefold=function(element,settings){var fold=$(window).height()+$(window).scrollTop();return fold<=$(element).offset().top-settings.threshold},$.abovethetop=function(element,settings){var top=$(window).scrollTop();return top>=$(element).offset().top+$(element).height()-settings.threshold},$.rightofscreen=function(element,settings){var fold=$(window).width()+$(window).scrollLeft();return fold<=$(element).offset().left-settings.threshold},$.leftofscreen=function(element,settings){var left=$(window).scrollLeft();return left>=$(element).offset().left+$(element).width()-settings.threshold},$.inviewport=function(element,settings){return!($.rightofscreen(element,settings)||$.leftofscreen(element,settings)||$.belowthefold(element,settings)||$.abovethetop(element,settings))
},$.extend($.expr[":"],{"below-the-fold":function(a){return $.belowthefold(a,{threshold:0})},"above-the-top":function(a){return $.abovethetop(a,{threshold:0})},"left-of-screen":function(a){return $.leftofscreen(a,{threshold:0})},"right-of-screen":function(a){return $.rightofscreen(a,{threshold:0})},"in-viewport":function(a){return $.inviewport(a,{threshold:0})},"in-viewport-b":function(a){return $.inviewport(a,{threshold:400})}})}(jQuery);var CLIENT=window.CLIENT||{};CLIENT.RichRelevance={linkToRrOnClick:!0,responseIsSkus:!0,rrMax:0,stickyBottomId:"rich-relevance-wrap",returnedRecs:{},loadRecsForSkus:function(recs,container,maxSkus){if("undefined"!=typeof container&&container.length){var containerId=container.attr("id");if("undefined"!=typeof recs.items){if("undefined"==typeof maxSkus)var maxSkus=4;var loopItems=recs.items;if(CLIENT.RichRelevance.responseIsSkus){var showProducts=CLIENT.RichRelevance.groupProducts(loopItems,container.attr("id"),maxSkus);"undefined"!=typeof showProducts&&0!=showProducts.length&&(loopItems=showProducts)}var workManager=$.Deferred(),attempts=0,workDone=function(response){if(attempts>=3)return void workManager.resolve();if(attempts++,$.Log.debug("Attempt: "+attempts+", All done loading: "+response),response>=maxSkus)$.Log.debug("Have enough, found max of "+maxSkus+" skus. Resolving"),workManager.resolve();else if(maxSkus>response){var loadedCount=maxSkus-response,nextProducts=CLIENT.RichRelevance.findMoreProducts(recs.items,loopItems,containerId,maxSkus,loadedCount);nextProducts.length?(loopItems=loopItems.concat(nextProducts),$.Log.debug("Found "+nextProducts.length+" more products to try and load"),work=CLIENT.RichRelevance.addProductsToUi(recs.items,container,containerId,nextProducts,maxSkus),work.done(workDone)):($.Log.debug("Done trying"),workManager.resolve())}},work=CLIENT.RichRelevance.addProductsToUi(recs.items,container,containerId,loopItems,maxSkus);work.done(workDone);var sendRecentRecsImpressions=function(){CLIENT.GoogleEC.sendGaEnhancedImpressions(!0,"#"+containerId);var richList="rr-recommend-container"==containerId?"Rich Recommendations":"Recently Viewed";ga("send","event","Category","loaded",richList,{nonInteraction:1})};workManager.done(CLIENT.RichRelevance.resetStickableNav,sendRecentRecsImpressions,CLIENT.Base.thumbnailOpacity)}}},resetStickableNav:function(){$.Log.debug("CLIENT.RichRelevance.resetStickable <- if stickable didn't work, find this function.");var leftbar=$("#filter-left-col"),pdpSticky=$(".sticky-add-to-cart");try{leftbar.length&&(CLIENT.Category.initOrResetStickable(),$.Log.debug("$.stickable.reset(); Rich Relevance Loaded")),pdpSticky.length&&(CLIENT.product.addToCart.initOrResetStickyAddToCart(),$.Log.debug("$.stickable.reset(); Rich Relevance Loaded"))}catch(e){console.error("stickable not working correctly"),console.dir(e)}},findMoreProducts:function(allRecs,loopItems,containerId,maxSkus,loadedCount){var missingCount=maxSkus-loadedCount,additionalProducts=CLIENT.RichRelevance.groupProducts(allRecs,containerId,loopItems.length+missingCount);if(additionalProducts.length>loopItems.length){$.Log.debug("Product Array with "+missingCount+" additional products");var newProducts=additionalProducts.filter(function(s){for(var a=0;a<loopItems.length;a++)if(loopItems[a].id==s.id)return!1;return!0});return newProducts}return $.Log.debug("No additional products found"),[]},addProductsToUi:function(allRecs,container,containerId,loopItems,maxSkus){var deferred=$.Deferred();"undefined"==typeof CLIENT.RichRelevance.returnedRecs[containerId]&&(CLIENT.RichRelevance.returnedRecs[containerId]={});for(var reqs=[],i=0;i<loopItems.length&&maxSkus>i;i++){var skuref=loopItems[i].id,linkURL=loopItems[i].linkURL;reqs[i]=CLIENT.RichRelevance.getProduct(container,skuref,linkURL)}var addedSuccessfully=0;return $.when.apply($,reqs).done(function(){$.Log.debug("All "+containerId+" requests have returned, push them in to the DOM now in the order RR sent them");for(var a=0;a<loopItems.length&&maxSkus>a;a++){var sk=loopItems[a].id,prod=CLIENT.RichRelevance.returnedRecs[containerId][sk];if(prod){if(container.append(prod),prod.find(".product-container-single").length){var image=prod.find("img.img-load-on-view");CLIENT.iosSlider.loadThumbs(image),image.closest(".prod-images").addClass("loaded")}else CLIENT.iosSlider.hoverLazyLoad(prod.find(".product-container")),prod.is(":in-viewport")&&(CLIENT.iosSlider.createCarousel(prod.find(".nix-carousel")),console.dir("Product is visible, loading",prod));addedSuccessfully++}}}).always(function(){$.Log.debug("resolving deferred with : "+addedSuccessfully),deferred.resolve(addedSuccessfully)}),deferred},getProduct:function(container,skuref,linkURL){return $.ajax({url:CLIENT.Settings.getHost()+"/slider/sku/"+skuref}).done(CLIENT.RichRelevance.handleProductResponse(container,skuref,linkURL))},handleProductResponse:function(container,skuref,linkURL){return function(response){var goToRr=CLIENT.RichRelevance.linkToRrOnClick,prod=$(response);if(prod.hasClass("nix-pcp-col")){if(goToRr){var rrOriginalUrl=linkURL,prodUrl=prod.find(".product-hotspot").attr("data-href"),newRrUrl=CLIENT.RichRelevance.getNewRrUrl(rrOriginalUrl,prodUrl,skuref),hotspot=prod.find(".product-hotspot");hotspot.attr("href",newRrUrl),hotspot.attr("data-rrUrl",rrOriginalUrl)}CLIENT.RichRelevance.returnedRecs[container.attr("id")][skuref]=prod,$.Log.debug("Added "+skuref+" to "+container.attr("id"))}}},getNewRrUrl:function(url,prodUrl,skuRef){var searchObject,parser=document.createElement("a");searchObject={};var queries,split,i;for(parser.href=url,queries=parser.search.replace(/^\?/,"").split("&"),i=0;i<queries.length;i++)split=queries[i].split("="),searchObject[split[0]]=split[1];var cleanProdUrl=prodUrl;if("function"==typeof removeDiacritics)try{cleanProdUrl=removeDiacritics(prodUrl)}catch(e){}searchObject.ct=CLIENT.Settings.getBaseHost()+cleanProdUrl+"?sku="+skuRef,searchObject.p=skuRef;var sep="";return 0!=parser.pathname.indexOf("/")&&(sep="/"),parser.protocol+"//"+parser.hostname+sep+parser.pathname+"?"+$.param(searchObject)},groupProducts:function(skus,container,maxSkus){if("undefined"!=typeof skus){var prods=[],prodStruct={};if("undefined"==typeof maxSkus)var maxSkus=200;$.Log.debug("Grouping skus from RichRelevance in to products.  Need to find "+maxSkus);for(var i=0;i<skus.length;i++){var productId=skus[i].parent_id,skuId=skus[i].id;if("undefined"==typeof productId&&"undefined"!=typeof skuId&&(productId=CLIENT.RichRelevance.prodFromSku(skuId)),"undefined"!=typeof productId&&"undefined"!=typeof skuId&&"undefined"==typeof prodStruct[productId]&&(skus[i].parent_id=productId,prods.push(skus[i]),prodStruct[productId]=!0,$.Log.debug("Adding "+skuId+" to return array")),prods.length>=maxSkus){$.Log.debug("Found "+maxSkus+" products to use in "+container+" continuing");break}}return prods}$.Log.debug("No skus submitted.")},watch:/(A[0-9]{3})[0-9\-]+/,kswatch:/(A[0-9]{3}KS)[0-9\-]+/,acc3:/(M[0-9]{4})[0-9\-]+/,acc2:/(C(015|034))[0-9\-]+/,acc:/(C[0-9]{4})[0-9\-]+/,clothing:/(S[0-9]{4})[0-9\-]+/,audio:/(H[0-9]{3})[0-9\-]+/,prodFromSku:function(skuref){return skuref.match(CLIENT.RichRelevance.kswatch)?skuref.match(CLIENT.RichRelevance.kswatch)[1]:skuref.match(CLIENT.RichRelevance.watch)?skuref.match(CLIENT.RichRelevance.watch)[1]:skuref.match(CLIENT.RichRelevance.acc3)?skuref.match(CLIENT.RichRelevance.acc3)[1]:skuref.match(CLIENT.RichRelevance.acc2)?skuref.match(CLIENT.RichRelevance.acc2)[1]:skuref.match(CLIENT.RichRelevance.acc)?skuref.match(CLIENT.RichRelevance.acc)[1]:skuref.match(CLIENT.RichRelevance.clothing)?skuref.match(CLIENT.RichRelevance.clothing)[1]:skuref.match(CLIENT.RichRelevance.audio)?skuref.match(CLIENT.RichRelevance.audio)[1]:void 0},loadProductSliderFromSkuIdList:function($productContainer,skus){$productContainer.length&&(skus.length>0?$.each(skus,function(a){if("undefined"!=typeof skus&&"undefined"!=typeof skus[a]){var urlVar="",skuProdVar="sku",refid=skus[a];-1!=skus[a].search("-")?urlVar=CLIENT.Settings.getHost()+"/slider/sku/"+skus[a]:(urlVar=CLIENT.Settings.getHost()+"/slider/product/"+skus[a],skuProdVar="prod");{$.ajax({url:urlVar}).then(function(response,textStatus,jqXHR){var prod=$($.trim(response));return prod.hasClass("nix-pcp-col")?jqXHR:$.Deferred().reject(response)}).done(function(response){var prod=$($.trim(response)),prodDetails=prod.find(".prod-details"),appendedButton="<button type='button' class='olapic-shop-now nix-btn nix-btn-dark'>"+CLIENT.Settings.alerts.olapic.shopNow+"</button>";if($(appendedButton).insertAfter(prodDetails),$productContainer.append(prod),$productContainer.append("sku"==skuProdVar?"<span class='loadSkuSuccess hide' data-prod-refid='"+refid+"'>loadSuccess</span>":"<span class='loadProdSuccess hide' data-prod-refid='"+refid+"'>loadSuccess</span>"),prod.find(".product-container-single").length){var image=prod.find(".item.single-color img");CLIENT.iosSlider.loadThumbs(image),image.closest(".prod-images").addClass("loaded"),prod.find(".item.single-color").off("click").on("click",function(){$(this).parents(".product-container").find(".product-hotspot").trigger("click")}).on("mouseover",function(){$(this).css("cursor","pointer")})}else CLIENT.iosSlider.hoverLazyLoad(prod.find(".product-container")),CLIENT.iosSlider.createCarousel(prod.find(".nix-carousel"))}).fail(function(){$productContainer.append("sku"==skuProdVar?"<span class='loadSku404 hide' data-prod-refid='"+refid+"'>sku404</span>":"<span class='loadProduct404 hide' data-prod-refid='"+refid+"'>prod404</span>")})}}else $productContainer.append("<span class='loadSku404 hide'>sku404</span>")}):$productContainer.append("<span class='loadSku404 hide'>sku404</span>"))},bindRichRelevanceLayers:function(recs,views){var rrContainer=$("#rich-relevance-wrap");if(recs||views){var gotBoth=!1;recs&&views&&(gotBoth=!0),recs&&(rrContainer.find("#rr-recommend-container").removeClass("hidden"),rrContainer.find("#recommend_tab").removeClass("hidden"),gotBoth||rrContainer.find("#recommend_tab").addClass("solo")),views&&(rrContainer.find("#rr-recent-container").removeClass("hidden"),rrContainer.find("#recent_tab").removeClass("hidden"),gotBoth||(rrContainer.find("#recent_tab").addClass("solo").addClass("tab_active"),rrContainer.find("#recommend_tab").removeClass("tab_active"),rrContainer.find("#rr-recommend-container").removeClass("tab_active_contents"),rrContainer.find("#rr-recent-container").addClass("tab_active_contents"))),$(".tab_active_contents").find(".nix-carousel").iosSlider("update"),rrContainer.removeClass("hidden"),rrContainer.parents(".products-display.landing_products_container.products-container").removeClass("hidden"),rrContainer.on("click touchstart",".richrecs",function(e){e.preventDefault();var $this=$(this);$this.hasClass("tab_active")||($(".richrecs").removeClass("tab_active"),$this.addClass("tab_active"),$(".extra-products-contents").toggleClass("tab_active_contents"),$(".tab_active_contents").find(".nix-carousel").iosSlider("update"),CLIENT.iosSlider.loadVisibleCarousels())})}else;}};