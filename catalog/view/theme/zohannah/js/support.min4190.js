/*! nixon 27-02-2015 */
var CLIENT=window.CLIENT||{};CLIENT.Support={contactUs:function(){$("#nixcontactform").scrupulous({defaultErrorMessage:CLIENT.Settings.alerts.base.required,valid:function(){return submitHandler($("#nixcontactform")),!1}}),$("#dealerPostalCode").bind("keyup",CLIENT.Support.zipCodeLookup),$("#countrySelect").each(function(){var selectedValue=$(this).val();$(this).html($("option",$(this)).sort(function(a,b){var repA=CLIENT.util.strReplaceAccents(a.text),repB=CLIENT.util.strReplaceAccents(b.text);return repA==repB?0:repB>repA?-1:1})),$(this).val(selectedValue)});var countrySelect=$("#countrySelect");countrySelect.change(function(){var selectedOption=$("option:selected",$(this));$(".contactinfotypes").hide(),""!==selectedOption.data("dealersemail")||""!==selectedOption.data("stickeremail")?($("#richTypes").show(),$("#stickerCountry").html($(this).val()),$("#dealerCountry").html($(this).val())):$("#defaultTypes").show();var ccountry=$(this).val();$("#stickerDealerState").html('<option value="">Choose State</option>'),$("#prospectingDealerState").html('<option value="">Choose State</option>'),$("#stateSource").children("option").each(function(){$(this).data("country")==ccountry&&($("#stickerDealerState").append($(this).clone()),$("#prospectingDealerState").append($(this).clone()))})}),countrySelect.trigger("change"),("en_US"==CLIENT.Settings.locale.code||"en_CA"==CLIENT.Settings.locale.code)&&($("#stickerPhone, #prospectingDealerPhone").usphone(),$("#stickerPhone, #prospectingDealerPhone").trigger("keyup")),$(".typeselects").change(function(){if($(this).hasClass("selected")){$(".contactforms").hide();var theform=$(this).children("option:selected").data("form");$("#"+theform).show(),enableDisableForms(theform)}else{$(".contactforms").slideUp("fast");var theform=$(this).children("option:selected").data("form");$("#"+theform).slideDown("fast"),enableDisableForms(theform),$(this).addClass("selected")}});var enableDisableForms=function(id){var allFields=$(".contactforms").find(".form-control, input[type=radio], input[type=checkbox]");allFields.prop("disabled",!0),allFields.removeClass("invalid").parents(".has-error").removeClass("has-error").find(".error-message").remove(),""!==id&&"undefined"!==id&&$("#"+id).find(".form-control, input[type=radio], input[type=checkbox]").prop("disabled",!1)};enableDisableForms();var submitHandler=function(form){if($("#stickerPostalCode").is(":visible")&&!$("#stickerCity").is(":visible"))return $("#stickerPostalCode").addClass("error"),$("label[for='stickerPostalCode']").show(),!1;if($("#dealerPostalCode").is(":visible")&&!$("#dealerCity").is(":visible"))return $("#dealerPostalCode").addClass("error"),$("label[for='dealerPostalCode']").show(),!1;$(".nixcontactform").find("button[type=submit]").each(function(){CLIENT.util.hideButton(this.id)});var countryValue=$(':input[name="country"]',form).val().toUpperCase(),countrySelection=$("#countrySelect option:selected"),contactTypeSelection=$("#infotypeSelect option:selected"),sendMailTo="";if($("#richTypes").is(":visible"))sendMailTo=contactTypeSelection.val(),sendMailTo="general"===sendMailTo?countrySelection.data("contactemail"):"service"===sendMailTo?countrySelection.data("warrantyemail"):"product"===sendMailTo?countrySelection.data("knowledgeemail"):"marketing"===sendMailTo?countrySelection.data("marketingemail"):"dealer"===sendMailTo?countrySelection.data("dealeremail"):"sticker"===sendMailTo?countrySelection.data("stickeremail"):contactTypeSelection.data("email"),(""==sendMailTo||void 0==sendMailTo)&&(sendMailTo="support@nixon.com");else{var selection=$("#infotype2Select option:selected");"general"==selection.val()&&(sendMailTo=countrySelection.data("contactemail")),"warranty"==selection.val()&&(sendMailTo=countrySelection.data("warrantyemail")),(""==sendMailTo||void 0==sendMailTo)&&(sendMailTo="support@nixon.com")}var useType="",infotype2="";infotype2=$(':input[name="infotype2"]',form).val(),useType=""!=infotype2?infotype2:$(':input[name="infotype"]',form).val();var fromAddr="";fromAddr=$(':input[name="fromAddress"]',form).val(),""==fromAddr&&(fromAddr=$(':input[name="dEmail"]',form).val()),""==fromAddr&&(fromAddr="info@nixon.com");var fieldsByType="";"dealer"==useType?(fieldsByType="STORE_NAME,FIRST_NAME,LAST_NAME,ADDR,ADDR2,CITY,",$(':input[name="zo_deal_state"]',form).length&&(fieldsByType+="STATE,"),fieldsByType+="POSTAL,PHONE,WEBSITE,EMAIL,STORE_TYPE,TIME_IN_BIZ,LOCATIONS,ONLINE,PRODUCT_CATS,TOP_BRANDS,HOW_HEARD,ADDL_INFO,COUNTRY"):"sticker"==useType?(fieldsByType="FNAME,LNAME,COMPANY,ADDRESS,TOWN,",$(':input[name="zo_stick_state"]',form).length&&(fieldsByType+="STATE_PROV,"),fieldsByType+="POSTAL_CODE,PHONE_NUMBER,COUNTRY"):fieldsByType="CONTACT_NAME,FROM_ADDRESS,MESSAGE,COUNTRY";var cts=new Array;cts=document.form1.elements.dProductCats;var catTxt="",k=0,i=0;for(i=0;i<cts.length;i++)cts[i].checked&&(k>0&&(catTxt+=" | "),catTxt+=cts[i].value,k++);var dataToSumbit={country:countryValue,toAddress:sendMailTo,infotype:useType,fromAddress:fromAddr,contactName:$(':input[name="contactName"]',form).val(),contactMessage:$(':input[name="contactMessage"]',form).val(),company:$(':input[name="company"]',form).val(),storeName:$(':input[name="dStoreName"]',form).val(),firstName:$(':input[name="dFirstName"]',form).val(),lastName:$(':input[name="dLastName"]',form).val(),address:$(':input[name="dAddress"]',form).val(),address2:$(':input[name="dAddress2"]',form).val(),city:$(':input[name="zo_deal_city"]',form).val(),state:$(':input[name="zo_deal_state"]',form).length?$(':input[name="zo_deal_state"]',form).val():"",postalCode:$(':input[name="zo_deal_postal_code"]',form).val(),phoneNumber:$(':input[name="dPhoneNumber"]',form).val(),website:$(':input[name="dWebsite"]',form).val(),email:$(':input[name="dEmail"]',form).val(),storeType:$(':input[name="dStoreType"]:radio:checked',form).val(),inBusiness:$(':input[name="dInBusiness"]',form).val(),locations:$(':input[name="dLocations"]',form).val(),onlineSales:$(':input[name="dOnlineSales"]:radio:checked',form).val(),productCats:catTxt,topBrands:$(':input[name="dTopBrands"]',form).val(),heardNixon:$(':input[name="dHeardNixon"]',form).val(),addlInfo:$(':input[name="dAddlInfo"]',form).val(),sFirstName:$(':input[name="firstName"]',form).val(),sLastName:$(':input[name="lastName"]',form).val(),sCompany:$(':input[name="company"]',form).val(),sAddress:$(':input[name="address"]',form).val(),sCity:$(':input[name="city"]',form).val(),sState:$(':input[name="state"]',form).val(),sPostalCode:$(':input[name="postalCode"]',form).val(),sPhoneNumber:$(':input[name="phoneNumber"]',form).val(),zin_save:"1",zin_type:"Contact-Nixon-"+useType,zin_fields:fieldsByType,"zin_value_STORE_NAME-1":$(':input[name="dStoreName"]',form).val(),"zin_value_FIRST_NAME-1":$(':input[name="dFirstName"]',form).val(),"zin_value_LAST_NAME-1":$(':input[name="dLastName"]',form).val(),"zin_value_ADDR-1":$(':input[name="dAddress"]',form).val(),"zin_value_ADDR2-1":$(':input[name="dAddress2"]',form).val(),"zin_value_CITY-1":$(':input[name="zo_deal_city"]',form).val(),"zin_value_STATE-1":$(':input[name="zo_deal_state"]',form).length?$(':input[name="zo_deal_state"]',form).val():"","zin_value_POSTAL-1":$(':input[name="zo_deal_postal_code"]',form).val(),"zin_value_PHONE-1":$(':input[name="dPhoneNumber"]',form).val(),"zin_value_WEBSITE-1":$(':input[name="dWebsite"]',form).val(),"zin_value_EMAIL-1":$(':input[name="dEmail"]',form).val(),"zin_value_STORE_TYPE-1":$(':input[name="dStoreType"]:radio:checked',form).val(),"zin_value_TIME_IN_BIZ-1":$(':input[name="dInBusiness"]',form).val(),"zin_value_LOCATIONS-1":$(':input[name="dLocations"]',form).val(),"zin_value_ONLINE-1":$(':input[name="dOnlineSales"]:radio:checked',form).val(),"zin_value_PRODUCT_CATS-1":catTxt,"zin_value_TOP_BRANDS-1":$(':input[name="dTopBrands"]',form).val(),"zin_value_HOW_HEARD-1":$(':input[name="dHeardNixon"]',form).val(),"zin_value_ADDL_INFO-1":$(':input[name="dAddlInfo"]',form).val(),"zin_value_CONTACT_NAME-1":$(':input[name="contactName"]',form).val(),"zin_value_FROM_ADDRESS-1":fromAddr,"zin_value_MESSAGE-1":$(':input[name="contactMessage"]',form).val(),"zin_value_FNAME-1":$(':input[name="firstName"]',form).val(),"zin_value_LNAME-1":$(':input[name="lastName"]',form).val(),"zin_value_COMPANY-1":$(':input[name="company"]',form).val(),"zin_value_ADDRESS-1":$(':input[name="address"]',form).val(),"zin_value_TOWN-1":$(':input[name="zo_stick_city"]',form).val(),"zin_value_STATE_PROV-1":$(':input[name="zo_stick_state"]',form).length?$(':input[name="zo_stick_state"]',form).val():"","zin_value_POSTAL_CODE-1":$(':input[name="zo_stick_postal_code"]',form).val(),"zin_value_PHONE_NUMBER-1":$(':input[name="phoneNumber"]',form).val(),"zin_value_COUNTRY-1":countryValue};$.post($(form).attr("data-action"),dataToSumbit,function(data,status){(-1!==data.indexOf('<div id="content">')||"success"==status)&&($("#contactform").hide(),$("#thanks").show())})}},zipCodeLookup:function(){if($.Log.debug("CLIENT.Support.zipCodeLookup"),"en_US"!=CLIENT.Settings.locale.code)return!1;var o=$(this),val=o.val(),results=null;if("undefined"!=typeof val&&5==val.length){var cacheValue=CLIENT.Cache.zipCodeLookup[val];"undefined"!=typeof cacheValue&&(results=cacheValue),null==results?CLIENT.Cache.lastZipCode==val?$.Log.debug("zipcode Looks the same to me, no action required"):(CLIENT.Cache.lastZipCode=val,$.Log.debug("Looking Up Results for: "+val,null,"DEBUG"),CLIENT.Support.zipCodeAjaxCall(val,o)):($.Log.debug(val+" found in cache."),CLIENT.Support.zipCodeUiUpdate(results,o))}},zipCodeAjaxCall:function(zip,o){$.Log.debug("CLIENT.Support.zipCodeAjaxCall"),$.ajax({url:CLIENT.Settings.getHost()+"/postalcode-search/",type:"POST",dataType:"json",data:{postalCode:zip},complete:function(response){if(200==response.status||"success"==response.statusText){var data=$.parseJSON(response.responseText);CLIENT.Cache.zipCodeLookup[zip]=data,CLIENT.Support.zipCodeUiUpdate(data,o)}else $.Log.debug("An Error Occurred on the call: "+response.statusText,null,"DEBUG")}})},zipCodeUiUpdate:function(data,o){if($.Log.debug("CLIENT.Support.zipCodeUiUpdate"),"object"!=typeof data)return $.Log.debug("data sent in is not an object"),!1;var inputName=o.attr("name"),city=data.city,state=data.state,country=data.country,errors={};if(errors[inputName]=CLIENT.Settings.alerts.checkout.zipCodeNotValid,"undefined"==typeof city||"undefined"==typeof state||"undefined"==typeof country)return $.Log.debug("missing city, state or country from data object"),o.addClass("invalidPostalCode"),void CLIENT.Support.throwValidatorError(errors);var canUpdate=!1,selectName=o.attr("id").replace("PostalCode","CountrySelect"),hiddenName=o.attr("id").replace("PostalCode","Country"),countrySelect=$("#"+selectName),hiddenCountry=$("#"+hiddenName);if(0==countrySelect.length)$.Log.debug("No CountrySelect found.. comparing to hidden _country_code input value"),hiddenCountry.val()==country?canUpdate=!0:$.Log.debug("Countries do not match: current: "+hiddenCountry.val()+" requested: "+country,null,"DEBUG");else{$.Log.debug("CountrySelect found.. checking to see if this country is an option in the select");var option=countrySelect.find("option[value='"+country+"']");0!=option.length&&(canUpdate=!0)}if(canUpdate){$.Log.debug("Country codes matched...Updating UI"),o.removeClass("invalidPostalCode");var cityName=o.attr("id").replace("PostalCode","City"),stateName=o.attr("id").replace("PostalCode","State");$("#"+cityName).val(city).trigger("keyup"),$("#"+stateName).val(state).trigger("keyup"),hiddenCountry.val(country),0!=countrySelect.length&&countrySelect.val(country),CLIENT.Support.updateAddressUI(o)}else o.addClass("invalidPostalCode"),CLIENT.Support.throwValidatorError(errors)},updateAddressUI:function(o){var type=o.attr("id").replace("PostalCode",""),city=$("#"+type+"CityWrapper"),state=$("#"+type+"StateSelectWrapper"),notice=$("#"+type+"PostalCodeNoticeWrapper"),country=$("#"+type+"CountryWrapper"),postal=$("#"+type+"PostalCodeWrapper");city.removeClass("hide"),state.removeClass("hide"),notice.addClass("hide"),country.removeClass("hide"),postal.removeClass("half").addClass("quarter")},throwValidatorError:function(errors){$.Log.debug("CLIENT.Support.throwValidatorError"),null!=errors&&"object"==typeof errors&&$.each(errors,function(formElementName,errorMessage){var $formControl=$("[name="+formElementName+"]");"zop_cc_exp_date-1"==formElementName&&($formControl=$("#ccexpyear"));var $formGroup=$formControl.parents(".form-group"),labelFor=$formControl.attr("id");$.Log.debug("Invalid form element: "+labelFor),$formGroup.hasClass("has-error")||($formControl.removeClass("valid").addClass("invalid"),$formControl.parent().removeClass("has-success").addClass("has-error"),$formControl.parent().append("<label class='error-message static' for='"+labelFor+"'>"+errorMessage+"</label>"))})}},CLIENT.Support.repairCenter=function(){var resetErrors=function($el){$el.removeClass("invalid").parents(".has-error").removeClass("has-error").find(".error-message").remove()};$("input[name=pythong]").on("change",function(){if(1==$("#pythonYes").prop("checked")){$("#pythonWarning").slideDown("fast"),$("#repairForm").addClass("formdisabled"),$(".formdisabled").find("input, checkbox, textarea, button, radio, select").prop("disabled",!0);var disabledErrors=$("#repair-center-form").find("input[disabled], select[disabled], textarea[disabled]");resetErrors(disabledErrors)}else $("#pythonWarning").slideUp("fast"),$("#repairForm").removeClass("formdisabled"),$("#repairForm").find("input, checkbox, textarea, button, radio, select").prop("disabled",!1)}),$("#model").change(function(){""===$(this).val()||($("#caseback").val("").prop("required",!1),resetErrors($("#caseback")),$(':input[name="zoi_value_RPR_MODEL-1"]').val($(this).val()))}),$("#caseback").change(function(){""===$(this).val()||($("#model").val("").prop("required",!1),resetErrors($("#model")),$(':input[name="zoi_value_RPR_CASEBACK-1"]').val($(this).val()))}),$("#liWarrantyYes").bind("change",function(){$("#liWarrantyYes").is(":checked")===!0&&$("#warrantyProofOfPurchaseWarning").slideDown("fast")}),$("#liWarrantyNo").bind("change",function(){$("#liWarrantyNo").is(":checked")===!0&&$("#warrantyProofOfPurchaseWarning").slideUp("fast")}),$("#liNotAvailable").bind("change",function(){$inputExplanation=$("#inputExplanation"),$inputExplanationDiv=$("#inputExplanationDiv"),$(this).is(":checked")?($inputExplanationDiv.slideDown("fast"),$inputExplanation.prop("disabled",!1)):($inputExplanationDiv.slideUp("fast"),$inputExplanation.prop("disabled",!0),resetErrors($inputExplanation))}),$("#repair-center-form").scrupulous({defaultErrorMessage:CLIENT.Settings.alerts.base.required,valid:function(){return submitRepairCenter(),!0}});var submitRepairCenter=function(){var form=$("#repair-center-form")[0],tmp=form.elements.month.value+" "+form.elements.year.value;form.elements["zoi_value_RPR_PURCHASE_DATE-1"].value=tmp.replace(/^\s+|\s+$/g,""),form.elements["zoi_value_RPR_MODEL-1"].value=form.elements.model.value,form.elements["zoi_value_RPR_CASEBACK-1"].value="undefined"==typeof form.elements.caseback?"":form.elements.caseback.value;var issuesList=$('input[name="issue"]:checked').map(function(){return $(this).attr("data-description")}).get().join(", "),localizedIssueList=document.createElement("input");localizedIssueList.type="hidden",localizedIssueList.name="zoi_value_RPR_ISSUE_LOCALIZED_DESC-1",localizedIssueList.value=issuesList,form.appendChild(localizedIssueList)}};