/*! nixon 27-02-2015 */
var CLIENT=window.CLIENT||{},ZC=window.ZC||{};CLIENT.Dealer={geocoder:null,map:null,markersAdded:!0,myAddress:new Array,myLat:new Array,myLng:new Array,myAddressComplete:new Array,myAddressTitle:new Array,myDealerType:new Array,marker:new Array,infowindow:new Array,currInfoWindow:null,totalAddresses:0,dealerResultsHeader:$("#dealer-results-header"),dealerResultsList:$("[data-results-list]"),dealerResult:$(".dealer-result"),dealerResultsMapId:"dealermap",dealerForm:$("#dealerform"),mapData:{marker:new Array,infoWindow:new Array,currInfoWindow:null},lightGray:[{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#d3d3d3"}]},{featureType:"transit",stylers:[{color:"#808080"},{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"on"},{color:"#b3b3b3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffffff"},{weight:1.8}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#d7d7d7"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ebebeb"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#a7a7a7"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#efefef"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#696969"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{visibility:"on"},{color:"#737373"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#d6d6d6"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#dadada"}]}],coolGrey:[{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{stylers:[{hue:"#00aaff"},{saturation:-100},{gamma:.75},{lightness:12}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{visibility:"on"},{lightness:24}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:57}]}],routeXL:[{featureType:"administrative",elementType:"all",stylers:[{visibility:"on"},{saturation:-100},{lightness:20}]},{featureType:"road",elementType:"all",stylers:[{visibility:"on"},{saturation:-100},{lightness:40}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{saturation:-10},{lightness:30}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"simplified"},{saturation:-60},{lightness:10}]},{featureType:"landscape.natural",elementType:"all",stylers:[{visibility:"simplified"},{saturation:-60},{lightness:60}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"},{saturation:-100},{lightness:60}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"},{saturation:-100},{lightness:60}]}],useStyle:null,setStyle:function(style){$.Log.debug("In GoogleMap Style to : "+style),"undefined"!=typeof style&&"undefined"!=typeof CLIENT.Dealer[style]&&($.Log.debug("Setting GoogleMap Style to : "+style),CLIENT.Dealer.useStyle=style)},setMapHeight:function(){var map=$("#mapWrapper"),winHeight=$(window).height();map.height(.6*winHeight)},init:function(){CLIENT.Dealer.loadDefaultMap(),CLIENT.Dealer.geoLocate(),CLIENT.Dealer.dealerForm.scrupulous({valid:function(){return $.Log.debug("#dealerform valid.  Thanks, Scrupulous!"),CLIENT.Dealer.dealerResultsHeader.hide(),CLIENT.Dealer.dealerResultsList.hide(),CLIENT.Dealer.dealerResult.remove(),CLIENT.Dealer.handleSearchRequest(this),!0},invalid:function(){return $.Log.debug("#dealerform NOT valid.  Thanks, Scrupulous!"),!1}}),$(window).resize($.debounce(200,function(){CLIENT.Dealer.setMapHeight()}))},loadDefaultMap:function(){var initLat=40.380028,initLng=-98.576202,mapOptions={zoom:4,center:new google.maps.LatLng(initLat,initLng),panControl:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.RIGHT_CENTER},scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};null!==CLIENT.Dealer.useStyle&&($.Log.debug("Using : "+CLIENT.Dealer.useStyle),mapOptions.styles=CLIENT.Dealer[CLIENT.Dealer.useStyle]),CLIENT.Dealer.map=new google.maps.Map(document.getElementById(CLIENT.Dealer.dealerResultsMapId),mapOptions)},geoLocate:function(){try{navigator.geolocation.getCurrentPosition(CLIENT.Dealer.handleGeoLocate,CLIENT.Dealer.geoLocateError)}catch(e){}},handleGeoLocate:function(position){if(position.coords){$(':input[name="latitude"]').val(position.coords.latitude),$(':input[name="longitude"]').val(position.coords.longitude),$(':input[name="proximity"]').val(25);var zoomLevel=8,initLat=position.coords.latitude,initLng=position.coords.longitude,mapOptions={zoom:zoomLevel,center:new google.maps.LatLng(initLat,initLng),panControl:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.RIGHT_CENTER},scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};null!==CLIENT.Dealer.useStyle&&($.Log.debug("Using : "+CLIENT.Dealer.useStyle),mapOptions.styles=CLIENT.Dealer[CLIENT.Dealer.useStyle])}CLIENT.Dealer.map=new google.maps.Map(document.getElementById(CLIENT.Dealer.dealerResultsMapId),mapOptions),CLIENT.Dealer.handleSearchRequest(CLIENT.Dealer.dealerForm)},geoLocateError:function(error){switch(error.code){case error.PERMISSION_DENIED:break;case error.POSITION_UNAVAILABLE:alert("We were unable to detect your current position");break;case error.TIMEOUT:alert("We were unable to detect your current position in a timely manner");break;default:alert("We were unable to detect your current position")}},handleSearchRequest:function(form){var zoomLevel,form=$(form),valueSet=$("#lazysearch",form).val(),$searchType=$(':input[name="search"]',form).val(),$intlSearch=$(':input[name="intlSearch"]',form).val(),$prox=$(':input[name="proximity"]',form).val();switch($prox){case"10":zoomLevel=10;break;case"25":zoomLevel=9;break;case"50":zoomLevel=8;break;case"100":zoomLevel=7;break;case"200":zoomLevel=6}var $source=$("#submitSource").val();if("user"===$source)try{null===CLIENT.Dealer.geocoder&&(CLIENT.Dealer.geocoder=new google.maps.Geocoder),CLIENT.Dealer.geocoder.geocode({address:valueSet},function(results,status){if(status===google.maps.GeocoderStatus.OK){var zipLatLng=results[0].geometry.location,latitude=null,longitude=null;if(latitude=zipLatLng.lat(),longitude=zipLatLng.lng(),$(':input[name="latitude"]',form).val(latitude),$(':input[name="longitude"]',form).val(longitude),isNaN(latitude)||isNaN(longitude))return console||alert("I'm sorry, an error occured while trying to perform your search, please try again later."),!1;$.getJSON(form.attr("action"),{search:$searchType,latitude:latitude,longitude:longitude,proximity:$prox,intlSearch:$intlSearch},function(data){CLIENT.Dealer.updateResultsList(data,$source),CLIENT.Dealer.updateMapDisplay(data)}).done(function(data){1==data.results.length?(CLIENT.Dealer.map.setZoom(10),CLIENT.Dealer.map.setCenter(new google.maps.LatLng(data.results[0].lat,data.results[0].lng))):(CLIENT.Dealer.map.setZoom(zoomLevel),CLIENT.Dealer.map.setCenter(new google.maps.LatLng(latitude,longitude)))})}else console||alert("I'm sorry, an error occured while trying to perform your search, please try again later.")})}catch(error){console||alert("I'm sorry, an error occured while trying to perform your search, please try again later.")}else $.getJSON(form.attr("action"),{search:$searchType,latitude:$(':input[name="latitude"]',form).val(),longitude:$(':input[name="longitude"]',form).val(),proximity:$prox,intlSearch:$intlSearch},function(data){CLIENT.Dealer.updateResultsList(data,$source),CLIENT.Dealer.updateMapDisplay(data)});return!1},updateMapDisplay:function(data){if(data.results===!1);else{CLIENT.Dealer.mapData.infoWindow=new Array;for(var i=0;i<CLIENT.Dealer.mapData.marker.length;i++)CLIENT.Dealer.mapData.marker[i].setVisible(!1),CLIENT.Dealer.mapData.marker[i].setMap(null);CLIENT.Dealer.mapData.marker=new Array,CLIENT.Dealer.mapData.currInfoWindow=null,$.each(data.results,function(i,dealer){CLIENT.Dealer.addMarker(dealer,i)}),CLIENT.Dealer.map.setCenter(new google.maps.LatLng(data.results[0].lat,data.results[0].lng))}},loadMarker:function(n){var resultRow="dealer-result-"+n;if(void 0===CLIENT.Dealer.mapData.infoWindow[n]||void 0===CLIENT.Dealer.mapData.marker[n])return!0;$(".dealer-result").removeClass("active"),null!==CLIENT.Dealer.mapData.currInfoWindow&&CLIENT.Dealer.mapData.currInfoWindow.close(),CLIENT.Dealer.mapData.infoWindow[n].open(CLIENT.Dealer.map,CLIENT.Dealer.mapData.marker[n]),CLIENT.Dealer.mapData.currInfoWindow=CLIENT.Dealer.mapData.infoWindow[n],CLIENT.Dealer.map.setCenter(CLIENT.Dealer.mapData.marker[n].position);{var $mapDiv=$("#dealermap");$(window).width()}$("body","html").animate({scrollTop:$mapDiv.offset().top-15},250),$("#"+resultRow).addClass("active")},addMarker:function(dealer,index){if(null===dealer||void 0===dealer)return!1;var markerLatLng=null,mapPin={path:"M40.8,22c0,20-20,40-20,40s-20-20-20-40c0-0.9,0.1-1.7,0.3-2.5  C2.3,9.6,10.6,2,20.8,2s18.5,7.6,19.7,17.5C40.6,20.3,40.8,21.1,40.8,22z",fillColor:"black",fillOpacity:1,scale:.45,origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,70)};markerLatLng=new google.maps.LatLng(dealer.lat,dealer.lng),CLIENT.Dealer.mapData.marker[index]=new google.maps.Marker({map:CLIENT.Dealer.map,position:markerLatLng,title:dealer.company,icon:mapPin}),ZC.Base.getAndParseTemplate("dealer-locator-result-map",dealer).done(function(response){CLIENT.Dealer.mapData.infoWindow[index]=new google.maps.InfoWindow({content:'<div class="infoWindow">'+response+"</div>"})}),google.maps.event.addListener(CLIENT.Dealer.mapData.marker[index],"click",function(){null!==CLIENT.Dealer.mapData.currInfoWindow&&CLIENT.Dealer.mapData.currInfoWindow.close(),CLIENT.Dealer.mapData.infoWindow[index].open(CLIENT.Dealer.map,CLIENT.Dealer.mapData.marker[index]),CLIENT.Dealer.mapData.currInfoWindow=CLIENT.Dealer.mapData.infoWindow[index]})},updateResultsList:function(data,$source){if(data.results===!1){var count,proximity=parseInt($("#proximity").val());message="user"==$source?CLIENT.Settings.alerts.dealerlocator.noresults:CLIENT.Settings.alerts.dealerlocator.noresultsproximity,200>proximity&&(message+="<br/><br/>",message=message+"<a href=\"javascript:void(0);\" onclick=\"$('#proximity').val('200'); CLIENT.Dealer.handleSearchRequest( $('#dealerform') );\">"+CLIENT.Settings.alerts.dealerlocator.expandsearch200+"</a>"),CLIENT.Dealer.dealerResultsList.html(message).show()}else ZC.Base.getAndParseTemplate("dealer-locator-results-list",data).done(function(response){count=data.results.length,$(window).width()>767&&CLIENT.Dealer.dealerResultsHeader.show(),CLIENT.Dealer.dealerResultsList.html(response).show(),$("#results-total-count").html("( "+count+" )"),6>count&&$("#dealer-header-row").css("padding-right","0")})}};